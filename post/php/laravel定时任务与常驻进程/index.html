<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Laravel å®šæ—¶ä»»åŠ¡ä¸å¸¸é©»è¿›ç¨‹ - ZsmHub - Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="ZsmHub" /><meta name="description" content="ä»»åŠ¡è°ƒåº¦åŠŸèƒ½ Laravel å‘½ä»¤è¡Œè°ƒåº¦å™¨å…è®¸ä½ åœ¨ Laravel ä¸­å¯¹å‘½ä»¤è°ƒåº¦è¿›è¡Œæ¸…æ™°æµç•…çš„å®šä¹‰ã€‚ä¸”ä½¿ç”¨è¿™ä¸ªä»»åŠ¡è°ƒåº¦å™¨æ—¶ï¼Œä½ åªéœ€è¦åœ¨ä½ çš„æœåŠ¡å™¨ä¸Šåˆ›å»ºå•ä¸ª Cron å…¥å£æ¥å£ã€‚ä½ çš„ä»»" /><meta name="keywords" content="Hugo, even, zsmhub, blog, php, golang" />






<meta name="generator" content="Hugo 0.82.0 with theme even" />


<link rel="canonical" href="https://zsmhub.github.io/post/php/laravel%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E4%B8%8E%E5%B8%B8%E9%A9%BB%E8%BF%9B%E7%A8%8B/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.eb0308f0e54ff86bb150b0f7f2912dd5f4eb4f67b1ee508094605ecd5b7dd679.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Laravel å®šæ—¶ä»»åŠ¡ä¸å¸¸é©»è¿›ç¨‹" />
<meta property="og:description" content="ä»»åŠ¡è°ƒåº¦åŠŸèƒ½ Laravel å‘½ä»¤è¡Œè°ƒåº¦å™¨å…è®¸ä½ åœ¨ Laravel ä¸­å¯¹å‘½ä»¤è°ƒåº¦è¿›è¡Œæ¸…æ™°æµç•…çš„å®šä¹‰ã€‚ä¸”ä½¿ç”¨è¿™ä¸ªä»»åŠ¡è°ƒåº¦å™¨æ—¶ï¼Œä½ åªéœ€è¦åœ¨ä½ çš„æœåŠ¡å™¨ä¸Šåˆ›å»ºå•ä¸ª Cron å…¥å£æ¥å£ã€‚ä½ çš„ä»»" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zsmhub.github.io/post/php/laravel%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E4%B8%8E%E5%B8%B8%E9%A9%BB%E8%BF%9B%E7%A8%8B/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2019-09-04T14:28:22&#43;08:00" />
<meta property="article:modified_time" content="2020-05-22T14:28:22&#43;08:00" />

<meta itemprop="name" content="Laravel å®šæ—¶ä»»åŠ¡ä¸å¸¸é©»è¿›ç¨‹">
<meta itemprop="description" content="ä»»åŠ¡è°ƒåº¦åŠŸèƒ½ Laravel å‘½ä»¤è¡Œè°ƒåº¦å™¨å…è®¸ä½ åœ¨ Laravel ä¸­å¯¹å‘½ä»¤è°ƒåº¦è¿›è¡Œæ¸…æ™°æµç•…çš„å®šä¹‰ã€‚ä¸”ä½¿ç”¨è¿™ä¸ªä»»åŠ¡è°ƒåº¦å™¨æ—¶ï¼Œä½ åªéœ€è¦åœ¨ä½ çš„æœåŠ¡å™¨ä¸Šåˆ›å»ºå•ä¸ª Cron å…¥å£æ¥å£ã€‚ä½ çš„ä»»"><meta itemprop="datePublished" content="2019-09-04T14:28:22&#43;08:00" />
<meta itemprop="dateModified" content="2020-05-22T14:28:22&#43;08:00" />
<meta itemprop="wordCount" content="2036">
<meta itemprop="keywords" content="Laravel," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Laravel å®šæ—¶ä»»åŠ¡ä¸å¸¸é©»è¿›ç¨‹"/>
<meta name="twitter:description" content="ä»»åŠ¡è°ƒåº¦åŠŸèƒ½ Laravel å‘½ä»¤è¡Œè°ƒåº¦å™¨å…è®¸ä½ åœ¨ Laravel ä¸­å¯¹å‘½ä»¤è°ƒåº¦è¿›è¡Œæ¸…æ™°æµç•…çš„å®šä¹‰ã€‚ä¸”ä½¿ç”¨è¿™ä¸ªä»»åŠ¡è°ƒåº¦å™¨æ—¶ï¼Œä½ åªéœ€è¦åœ¨ä½ çš„æœåŠ¡å™¨ä¸Šåˆ›å»ºå•ä¸ª Cron å…¥å£æ¥å£ã€‚ä½ çš„ä»»"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">ZsmHub Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">é¦–é¡µ</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">å½’æ¡£</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">åˆ†ç±»</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">æ ‡ç­¾</li>
      </a><a href="/navigation">
        <li class="mobile-menu-item">å¯¼èˆª</li>
      </a><a href="/about">
        <li class="mobile-menu-item">å…³äº</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">ZsmHub Blog</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">é¦–é¡µ</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">å½’æ¡£</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">åˆ†ç±»</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">æ ‡ç­¾</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/navigation">å¯¼èˆª</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about">å…³äº</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Laravel å®šæ—¶ä»»åŠ¡ä¸å¸¸é©»è¿›ç¨‹</h1>

      <div class="post-meta">
        <span class="post-time"> 2019-09-04 </span>
        <div class="post-category">
            <a href="/categories/php/"> php </a>
            </div>
          <span class="more-meta"> çº¦ 2036 å­— </span>
          <span class="more-meta"> é¢„è®¡é˜…è¯» 5 åˆ†é’Ÿ </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">æ–‡ç« ç›®å½•</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#ä»»åŠ¡è°ƒåº¦åŠŸèƒ½">ä»»åŠ¡è°ƒåº¦åŠŸèƒ½</a></li>
    <li><a href="#å®šæ—¶ä»»åŠ¡å®ç°æ–¹æ¡ˆ">å®šæ—¶ä»»åŠ¡å®ç°æ–¹æ¡ˆ</a></li>
    <li><a href="#å¸¸é©»è¿›ç¨‹å®ç°æ–¹æ¡ˆ">å¸¸é©»è¿›ç¨‹å®ç°æ–¹æ¡ˆ</a></li>
    <li><a href="#è¿è¡Œé˜Ÿåˆ—å¤„ç†å™¨">è¿è¡Œé˜Ÿåˆ—å¤„ç†å™¨</a></li>
    <li><a href="#docker-å¦‚ä½•å¯åŠ¨-horizon">docker å¦‚ä½•å¯åŠ¨ horizon</a></li>
    <li><a href="#supervisor-éƒ¨ç½²">supervisor éƒ¨ç½²</a></li>
    <li><a href="#laravel-æ—¥å¿—æ‹¥æœ‰è€…ç»å¸¸å˜æ›´ä¸º-root">Laravel æ—¥å¿—æ‹¥æœ‰è€…ç»å¸¸å˜æ›´ä¸º root</a></li>
    <li><a href="#é…ç½®æ–‡ä»¶è§£è¯»">é…ç½®æ–‡ä»¶è§£è¯»</a></li>
    <li><a href="#å¥½æ–‡æ¨è">å¥½æ–‡æ¨è</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="ä»»åŠ¡è°ƒåº¦åŠŸèƒ½">ä»»åŠ¡è°ƒåº¦åŠŸèƒ½</h2>
<p>Laravel å‘½ä»¤è¡Œè°ƒåº¦å™¨å…è®¸ä½ åœ¨ Laravel ä¸­å¯¹å‘½ä»¤è°ƒåº¦è¿›è¡Œæ¸…æ™°æµç•…çš„å®šä¹‰ã€‚ä¸”ä½¿ç”¨è¿™ä¸ªä»»åŠ¡è°ƒåº¦å™¨æ—¶ï¼Œä½ åªéœ€è¦åœ¨ä½ çš„æœåŠ¡å™¨ä¸Šåˆ›å»ºå•ä¸ª Cron å…¥å£æ¥å£ã€‚ä½ çš„ä»»åŠ¡è°ƒåº¦åœ¨ app/Console/Kernel.php çš„ schedule æ–¹æ³•ä¸­è¿›è¡Œå®šä¹‰ã€‚</p>
<p>å¦‚æœå®šæ—¶ä»»åŠ¡ä»£ç ç›´æ¥é…ç½®åœ¨ linux ä¸‹çš„ crontab ä¸‹è¿è¡Œï¼Œåˆ™ä¿®æ”¹å®šæ—¶ä»»åŠ¡ç›¸å…³ä»£ç åï¼Œä¸éœ€è¦åšä»»ä½•é‡å¯ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># å¯åŠ¨è°ƒåº¦å™¨ï¼Œä¸€èˆ¬é…ç½®åœ¨ www ç”¨æˆ·ä¸‹</span>
* * * * * <span class="nb">cd</span> /path-to-your-project <span class="o">&amp;&amp;</span> php artisan schedule:run &gt;&gt; /dev/null 2&gt;<span class="p">&amp;</span><span class="m">1</span>

<span class="c1"># ä½¿ç”¨é—­åŒ…æ¥å®šä¹‰ä»»åŠ¡è°ƒåº¦</span>
<span class="nv">$schedule</span>-&gt;call<span class="o">(</span>new DeleteRecentUsers<span class="o">)</span>-&gt;daily<span class="o">()</span><span class="p">;</span>

<span class="c1"># ä½¿ç”¨ Artisan å‘½ä»¤è°ƒåº¦</span>
<span class="nv">$schedule</span>-&gt;command<span class="o">(</span><span class="s1">&#39;emails:send --force&#39;</span><span class="o">)</span>-&gt;daily<span class="o">()</span><span class="p">;</span>

<span class="c1"># é˜Ÿåˆ—ä»»åŠ¡è°ƒåº¦</span>
<span class="nv">$schedule</span>-&gt;job<span class="o">(</span>new Heartbeat, <span class="s1">&#39;heartbeats&#39;</span><span class="o">)</span>-&gt;everyFiveMinutes<span class="o">()</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="å®šæ—¶ä»»åŠ¡å®ç°æ–¹æ¡ˆ">å®šæ—¶ä»»åŠ¡å®ç°æ–¹æ¡ˆ</h2>
<p><a href="https://blog.csdn.net/lw545034502/article/details/85061475">å‚è€ƒæ–‡ç« </a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">php artisan make:command SyncBindVipZny // åˆ›å»ºå®šæ—¶ä»»åŠ¡æ–‡ä»¶ï¼šcommand/SyncBindVipZny.php
</code></pre></td></tr></table>
</div>
</div><p>å®šæ—¶ä»»åŠ¡ä»£ç å†™åœ¨ app/console/commands ä¸‹ã€‚ä¸€äº›éå®šæ—¶ä»»åŠ¡çš„è„šæœ¬ä¹Ÿå¯ä»¥å†™åœ¨ commands ä¸‹</p>
<h2 id="å¸¸é©»è¿›ç¨‹å®ç°æ–¹æ¡ˆ">å¸¸é©»è¿›ç¨‹å®ç°æ–¹æ¡ˆ</h2>
<p>å¸¸é©»è¿›ç¨‹å†™åœ¨ app/jobs ä¸‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">php artisan make:job TestJob

<span class="c1"># éœ€å¯åŠ¨ horizonï¼Œè®¿é—®è·¯ç”±ï¼šhttp://xxx/horizon/ï¼Œä¸€èˆ¬ä½¿ç”¨ supervisor é…ç½®</span>
php artisan horizon <span class="c1"># é˜Ÿåˆ—ç›‘æ§ï¼Œç”¨æ¥ä»£æ›¿ Laravel è‡ªå¸¦çš„ artisan queue:listen/workï¼Œéœ€è¦å¸¸é©»è¿è¡Œ</span>

<span class="c1"># å°†ä½œä¸šæ¨é€åˆ°ç‰¹å®šçš„é˜Ÿåˆ—çš„å‡ ç§æ–¹å¼</span>
dispatch<span class="o">(</span>new InvoiceEmail<span class="o">(</span><span class="nv">$order</span><span class="o">))</span>-&gt;onConnection<span class="o">(</span><span class="s1">&#39;è¿æ¥åç§°&#39;</span><span class="o">)</span>-&gt;onQueue<span class="o">(</span><span class="s1">&#39;é˜Ÿåˆ—åç§°&#39;</span><span class="o">)</span><span class="p">;</span>
InvoiceEmail::dispatch<span class="o">(</span><span class="nv">$order</span><span class="o">)</span>-&gt;onQueue<span class="o">(</span><span class="s1">&#39;é˜Ÿåˆ—åç§°&#39;</span><span class="o">)</span><span class="p">;</span>
dispatchNow<span class="o">(</span>new InvoiceEmail<span class="o">(</span><span class="nv">$order</span><span class="o">))</span>-&gt;onQueue<span class="o">(</span><span class="s1">&#39;é˜Ÿåˆ—åç§°&#39;</span><span class="o">)</span><span class="p">;</span> // ä½¿ç”¨æ­¤æ–¹æ³•æ—¶ï¼Œé˜Ÿåˆ—ä»»åŠ¡å°†ä¸ä¼šæ’é˜Ÿï¼Œå¹¶ç«‹å³åœ¨å½“å‰è¿›ç¨‹ä¸­è¿è¡Œ
Queue::connection<span class="o">(</span><span class="s1">&#39;è¿æ¥åç§°&#39;</span><span class="o">)</span>-&gt;pushOn<span class="o">(</span><span class="s1">&#39;é˜Ÿåˆ—åç§°&#39;</span>, new InvoiceEmail<span class="o">(</span><span class="nv">$order</span><span class="o">))</span><span class="p">;</span> // Laravel 5.0 åŠä¹‹å‰æ—§ç‰ˆæœ¬çš„ç”¨æ³•
Queue::push<span class="o">(</span>new InvoiceEmail<span class="o">(</span><span class="nv">$order</span><span class="o">)</span>, <span class="s1">&#39;&#39;</span>, <span class="s1">&#39;é˜Ÿåˆ—åç§°&#39;</span><span class="o">)</span><span class="p">;</span> // Laravel 5.0 åŠä¹‹å‰æ—§ç‰ˆæœ¬çš„ç”¨æ³•

// åœ¨ç»™å®šçš„ç§’æ•°ä¹‹åæ¨é€ä½œä¸šçš„å‡ ç§æ–¹å¼
dispatch<span class="o">(</span>new InvoiceEmail<span class="o">(</span><span class="nv">$order</span><span class="o">))</span>-&gt;onQueue<span class="o">(</span><span class="s1">&#39;emails&#39;</span><span class="o">)</span>-&gt;delay<span class="o">(</span>60<span class="o">)</span><span class="p">;</span>
Queue::later<span class="o">(</span>60, new InvoiceEmail<span class="o">(</span><span class="nv">$order</span><span class="o">)</span>, <span class="s1">&#39;&#39;</span>, <span class="s1">&#39;é˜Ÿåˆ—åç§°&#39;</span><span class="o">)</span><span class="p">;</span> // Laravel 5.0 åŠä¹‹å‰æ—§ç‰ˆæœ¬çš„ç”¨æ³•
Queue::laterOn<span class="o">(</span><span class="s1">&#39;é˜Ÿåˆ—åç§°&#39;</span>, 60, new InvoiceEmail<span class="o">(</span><span class="nv">$order</span><span class="o">))</span><span class="p">;</span> // Laravel 5.0 åŠä¹‹å‰æ—§ç‰ˆæœ¬çš„ç”¨æ³•

// æ¨é€å¤šä¸ªä½œä¸š
Queue::bulk<span class="o">([</span>
    new InvoiceEmail<span class="o">(</span><span class="nv">$order</span><span class="o">)</span>,
    new ThankYouEmail<span class="o">(</span><span class="nv">$order</span><span class="o">)</span>
<span class="o">])</span><span class="p">;</span>

// æ¨é€ç‰¹å®šé˜Ÿåˆ—ä¸Šçš„å¤šä¸ªä½œä¸š
Queue::bulk<span class="o">([</span>
    new InvoiceEmail<span class="o">(</span><span class="nv">$order</span><span class="o">)</span>,
    new ThankYouEmail<span class="o">(</span><span class="nv">$order</span><span class="o">)</span>
<span class="o">]</span>, null, <span class="s1">&#39;emails&#39;</span><span class="o">)</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="è¿è¡Œé˜Ÿåˆ—å¤„ç†å™¨">è¿è¡Œé˜Ÿåˆ—å¤„ç†å™¨</h2>
<ul>
<li>php artisan queue:listen</li>
<li>php artisan queue:work</li>
<li>php artisan horizon</li>
</ul>
<h2 id="docker-å¦‚ä½•å¯åŠ¨-horizon">docker å¦‚ä½•å¯åŠ¨ horizon</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># è¿›å…¥ docker ç¯å¢ƒ</span>
docker <span class="nb">exec</span> -it php sh

<span class="c1"># è¿è¡Œ horizon</span>
php artisan horizon
</code></pre></td></tr></table>
</div>
</div><h2 id="supervisor-éƒ¨ç½²">supervisor éƒ¨ç½²</h2>
<p>Supervisor æ˜¯ä¸€ä¸ª Python å†™çš„è¿›ç¨‹ç®¡ç†å·¥å…·ï¼Œæœ‰æ—¶ä¸€ä¸ªè¿›ç¨‹éœ€è¦åœ¨åå°è¿è¡Œï¼Œå¹¶ä¸”æ„å¤–æŒ‚æ‰åèƒ½å¤Ÿè‡ªåŠ¨é‡å¯ï¼Œå°±éœ€è¦è¿™ä¹ˆä¸€ä¸ªç®¡ç†è¿›ç¨‹çš„å·¥å…·ã€‚</p>
<p>åœ¨ linux ä¸‹å®‰è£…supervisorï¼Œç„¶ååœ¨ supervisor ä¸‹é…ç½®ä¸¤é¡¹ä»»åŠ¡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">php artisan horizon <span class="c1"># å¸¸é©»è¿›ç¨‹ï¼Œuser éœ€æŒ‡å®šä¸º www ç”¨æˆ·</span>
php artisan schedule:run <span class="c1"># å®šæ—¶ä»»åŠ¡ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ crontab -e -u www é…ç½®ï¼Œ</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="laravel-æ—¥å¿—æ‹¥æœ‰è€…ç»å¸¸å˜æ›´ä¸º-root">Laravel æ—¥å¿—æ‹¥æœ‰è€…ç»å¸¸å˜æ›´ä¸º root</h2>
<ol>
<li>
<p>èµ·å› ï¼šä¸€ã€åœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨äº† root crontabï¼Œè‡´ä½¿ç”Ÿæˆçš„æ—¥å¿—æ–‡ä»¶çš„æ‰€å±è€…å…¨ä¸º root ç”¨æˆ·ï¼Œå¯¼è‡´ç¨‹åºåœ¨å†™å…¥æ—¥å¿—æ˜¾ç¤ºæ²¡æœ‰æƒé™å†™å…¥ï¼›äºŒã€ä¹Ÿå¯èƒ½æ˜¯ supervisor é…ç½®çš„å¸¸é©»ä»»åŠ¡æ²¡æœ‰é…ç½®åœ¨ www ä¸‹</p>
</li>
<li>
<p>è§£å†³æ–¹æ³•ã€‚å†æ‰§è¡Œå®šæ—¶å™¨æ—¶ï¼Œç”¨åœ¨ www ç”¨æˆ·ä¸‹è¿›è¡Œå®šæ—¶è®¾ç½®ï¼šå‘½ä»¤ä¸º</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">crontab -e -u www

supervisor é…ç½®ï¼šuser<span class="o">=</span>www
</code></pre></td></tr></table>
</div>
</div></li>
</ol>
<h2 id="é…ç½®æ–‡ä»¶è§£è¯»">é…ç½®æ–‡ä»¶è§£è¯»</h2>
<ul>
<li>config/database.php: redis æ•°æ®åº“åŠå…¶ä»–ç±»å‹æ•°æ®åº“çš„é…ç½®</li>
<li>config/queue.php: é˜Ÿåˆ—é©±åŠ¨é…ç½®</li>
<li>config/horizon.php: é˜Ÿåˆ—ç®¡ç†å·¥å…·é…ç½®</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">// config/queue.php: é˜Ÿåˆ—é©±åŠ¨ç±»å‹
<span class="s1">&#39;connections&#39;</span> <span class="o">=</span>&gt; <span class="o">[</span>
    <span class="s1">&#39;redis&#39;</span> <span class="o">=</span>&gt; <span class="o">[</span>
        <span class="s1">&#39;driver&#39;</span> <span class="o">=</span>&gt; <span class="s1">&#39;redis&#39;</span>,
        <span class="s1">&#39;connection&#39;</span> <span class="o">=</span>&gt; <span class="s1">&#39;queue&#39;</span>, // é…ç½®è¿æ¥å“ªä¸ª redis æ•°æ®åº“ï¼Œç”¨äº job çš„å­˜å‚¨
        <span class="s1">&#39;queue&#39;</span> <span class="o">=</span>&gt; <span class="s1">&#39;default&#39;</span>, // é»˜è®¤é˜Ÿåˆ—åç§°
        <span class="s1">&#39;retry_after&#39;</span> <span class="o">=</span>&gt; 300, // ä»»åŠ¡è¿‡æœŸï¼šè¿™ä¸ªé€‰é¡¹æŒ‡å®šäº†é˜Ÿåˆ—è¿æ¥åœ¨é‡è¯•ä¸€ä¸ªä»»åŠ¡å‰åº”è¯¥ç­‰å®ƒæ‰§è¡Œå¤šä¹…
        <span class="s1">&#39;block_for&#39;</span> <span class="o">=</span>&gt; 3, // é˜»å¡ï¼šå°†å¤±è´¥ä»»åŠ¡é‡æ–°æ”¾å…¥ Redis æ•°æ®åº“ä»¥åŠå¤„ç†å™¨è½®è¯¢ä¹‹å‰é˜»å¡å¤šä¹…
    <span class="o">]</span>,
<span class="o">]</span>

// config/database.php
<span class="s1">&#39;redis&#39;</span> <span class="o">=</span>&gt; <span class="o">[</span>
    <span class="s1">&#39;default&#39;</span> <span class="o">=</span>&gt; <span class="o">[</span>
        <span class="s1">&#39;host&#39;</span> <span class="o">=</span>&gt; env<span class="o">(</span><span class="s1">&#39;REDIS_HOST&#39;</span>, <span class="s1">&#39;redis&#39;</span><span class="o">)</span>,
        <span class="s1">&#39;password&#39;</span> <span class="o">=</span>&gt; env<span class="o">(</span><span class="s1">&#39;REDIS_PASSWORD&#39;</span>, null<span class="o">)</span>,
        <span class="s1">&#39;port&#39;</span> <span class="o">=</span>&gt; env<span class="o">(</span><span class="s1">&#39;REDIS_PORT&#39;</span>, 6379<span class="o">)</span>,
        <span class="s1">&#39;database&#39;</span> <span class="o">=</span>&gt; 0,
    <span class="o">]</span>,
    <span class="s1">&#39;horizon-task&#39;</span> <span class="o">=</span>&gt; <span class="o">[</span>
        <span class="s1">&#39;host&#39;</span> <span class="o">=</span>&gt; env<span class="o">(</span><span class="s1">&#39;REDIS_HOST&#39;</span>, <span class="s1">&#39;redis&#39;</span><span class="o">)</span>,
        <span class="s1">&#39;password&#39;</span> <span class="o">=</span>&gt; env<span class="o">(</span><span class="s1">&#39;REDIS_PASSWORD_QUEUE&#39;</span>, null<span class="o">)</span>,
        <span class="s1">&#39;port&#39;</span> <span class="o">=</span>&gt; env<span class="o">(</span><span class="s1">&#39;REDIS_PORT_QUEUE&#39;</span>, 6379<span class="o">)</span>,
        <span class="s1">&#39;database&#39;</span> <span class="o">=</span>&gt; 1,
    <span class="o">]</span>,
<span class="o">]</span>

// config/horizon.php: Queue Worker Configuration
<span class="s1">&#39;use&#39;</span> <span class="o">=</span>&gt; <span class="s1">&#39;horizon-task&#39;</span>, // é…ç½® horizon ç›‘æ§å°ç›¸å…³ä¿¡æ¯å­˜å‚¨çš„ redis åº“ï¼Œè¯·çœ‹ä¸Šé¢ database.php çš„ redis é…ç½®
<span class="s1">&#39;environments&#39;</span> <span class="o">=</span>&gt; <span class="o">[</span>
    <span class="s1">&#39;production&#39;</span> <span class="o">=</span>&gt; <span class="o">[</span>
        <span class="s1">&#39;supervisor-1&#39;</span> <span class="o">=</span>&gt; <span class="o">[</span>
            <span class="s1">&#39;connection&#39;</span> <span class="o">=</span>&gt; <span class="s1">&#39;redis&#39;</span>,
            <span class="s1">&#39;queue&#39;</span> <span class="o">=</span>&gt; <span class="o">[</span><span class="s1">&#39;default&#39;</span>, <span class="s1">&#39;test&#39;</span><span class="o">]</span>, // é˜Ÿåˆ—åç§°é…ç½®
            <span class="s1">&#39;balance&#39;</span> <span class="o">=</span>&gt; <span class="s1">&#39;simple&#39;</span>, // è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼šfalse/simple/auto
            <span class="s1">&#39;processes&#39;</span> <span class="o">=</span>&gt; 20, // è¿›ç¨‹æ•°
            <span class="s1">&#39;tries&#39;</span> <span class="o">=</span>&gt; 2, // ä»»åŠ¡å¤±è´¥é‡å¯æ¬¡æ•°
            <span class="s1">&#39;timeout&#39;</span> <span class="o">=</span>&gt; 120, // é˜Ÿåˆ—è¶…æ—¶æ—¶é—´
            <span class="s1">&#39;sleep&#39;</span> <span class="o">=</span>&gt; <span class="m">3</span> // é˜Ÿåˆ—è¿›ç¨‹ç¡çœ æ—¶é—´ï¼šå½“ä»»åŠ¡åœ¨é˜Ÿåˆ—ä¸­å¯ç”¨æ—¶ï¼Œå¤„ç†å™¨å°†ä¼šä¸€ç›´æ— é—´éš”åœ°å¤„ç†ä»»åŠ¡ã€‚ ç„¶è€Œï¼Œ sleep é€‰é¡¹å®šä¹‰äº†å¦‚æœæ²¡æœ‰æ–°ä»»åŠ¡çš„æ—¶å€™å¤„ç†å™¨å°†ä¼šã€Œç¡çœ ã€å¤šé•¿æ—¶é—´ã€‚åœ¨å¤„ç†å™¨ç¡çœ æ—¶ï¼Œå®ƒä¸ä¼šå¤„ç†ä»»ä½•æ–°ä»»åŠ¡ â€”â€” ä»»åŠ¡å°†ä¼šåœ¨é˜Ÿåˆ—å¤„ç†å™¨å†æ¬¡å¯åŠ¨åæ‰§è¡Œã€‚
        <span class="o">]</span>,
        // é…ç½®å¤šä¸ª<span class="s2">&#34;supervisors&#34;</span>ï¼Œä¾¿äºèµ„æºåˆ†é…
        <span class="s1">&#39;supervisor-2&#39;</span> <span class="o">=</span>&gt; <span class="o">[</span>
            <span class="s1">&#39;connection&#39;</span> <span class="o">=</span>&gt; <span class="s1">&#39;redis&#39;</span>,
            <span class="s1">&#39;queue&#39;</span> <span class="o">=</span>&gt; <span class="o">[</span><span class="s1">&#39;task&#39;</span><span class="o">]</span>,
            <span class="s1">&#39;balance&#39;</span> <span class="o">=</span>&gt; <span class="s1">&#39;simple&#39;</span>,
            <span class="s1">&#39;processes&#39;</span> <span class="o">=</span>&gt; 30,
            <span class="s1">&#39;tries&#39;</span> <span class="o">=</span>&gt; 3,
            <span class="s1">&#39;timeout&#39;</span> <span class="o">=</span>&gt; 600,
            <span class="s1">&#39;sleep&#39;</span> <span class="o">=</span>&gt; <span class="m">3</span>
        <span class="o">]</span>,
    <span class="o">]</span>,
<span class="o">]</span>

// HorizonåŒ…æ‹¬ä¸€ä¸ªMetricsä»ªè¡¨æ¿ï¼Œå®ƒæä¾›å…³äºæ‚¨çš„ä½œä¸šå’Œé˜Ÿåˆ—ç­‰å¾…æ—¶é—´ä»¥åŠååé‡çš„ä¿¡æ¯ã€‚ä¸ºäº†å¡«å……æ­¤ä»ªè¡¨æ¿ï¼Œåº”é…ç½®Horizonçš„å¿«ç…§Artisanå‘½ä»¤ï¼Œä½¿å…¶æ¯äº”åˆ†é’Ÿé€šè¿‡åº”ç”¨ç¨‹åºçš„è®¡åˆ’ç¨‹åºè¿è¡Œä¸€æ¬¡
/**
 * Define the application<span class="s1">&#39;s command schedule.
</span><span class="s1"> *
</span><span class="s1"> * @param  \Illuminate\Console\Scheduling\Schedule  $schedule
</span><span class="s1"> * @return void
</span><span class="s1"> */
</span><span class="s1">protected function schedule(Schedule $schedule)
</span><span class="s1">{
</span><span class="s1">    $schedule-&gt;command(&#39;</span>horizon:snapshot<span class="err">&#39;</span><span class="o">)</span>-&gt;everyFiveMinutes<span class="o">()</span><span class="p">;</span>
<span class="o">}</span>

// é»˜è®¤æƒ…å†µä¸‹ï¼Œä½ åªèƒ½åœ¨ <span class="nb">local</span> ç¯å¢ƒä¸‹è®¿é—®è¿™ä¸ªåå°ã€‚å¦‚æœæƒ³è¦ä¸ºåå°å®šä¹‰æ›´å¤šçš„ç‰¹å®šè®¿é—®ç­–ç•¥ï¼Œéœ€è¦ä½¿ç”¨ Horizon:auth æ–¹æ³•ã€‚auth æ–¹æ³•æ¥æ”¶ä¸€ä¸ªè¿”å› <span class="nb">true</span> æˆ– <span class="nb">false</span> çš„å›è°ƒï¼Œä»è€Œå†³å®šç”¨æˆ·æ˜¯å¦å¯ä»¥è®¿é—® Horizon åå°ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šåœ¨ AppServiceProvider çš„ boot æ–¹æ³•ä¸­è°ƒç”¨ Horizon:authï¼š
Horizon::auth<span class="o">(</span><span class="k">function</span> <span class="o">(</span><span class="nv">$request</span><span class="o">)</span> <span class="o">{</span>
    // <span class="k">return</span> <span class="nb">true</span> / false<span class="p">;</span>
<span class="o">})</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="å¥½æ–‡æ¨è">å¥½æ–‡æ¨è</h2>
<p><a href="https://learnku.com/laravel/t/37579#reply143338">é…ç½® Horizon çš„ queue, balance, processes å‚æ•°ä»¥åŠ Redis ä¸­çš„ä¼˜å…ˆçº§</a></p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">æ–‡ç« ä½œè€…</span>
    <span class="item-content"><a href="https://zsmhub.github.io/" class="theme-link">ZsmHub</a></span>
  </p>
  <p class="copyright-item">
    <span class="item-title">ä¸Šæ¬¡æ›´æ–°</span>
    <span class="item-content">
        2020-05-22
        
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">è®¸å¯åè®®</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>
<div class="post-reward">
  <input type="checkbox" name="reward" id="reward" hidden />
  <label class="reward-button" for="reward">ğŸ‘ğŸ» å–œæ¬¢æ–‡ç«  ğŸ‘€</label>
  <div class="qr-code">
    
    <label class="qr-code-image" for="reward">
        <img class="image" src="/images/wechat-qr-code.png" alt="è¯·å…ˆç§‘å­¦ä¸Šç½‘">
        <span>å¾®ä¿¡æ‰“èµ</span>
      </label>
    <label class="qr-code-image" for="reward">
        <img class="image" src="/images/alipay-qr-code.png" alt="è¯·å…ˆç§‘å­¦ä¸Šç½‘">
        <span>æ”¯ä»˜å®æ‰“èµ</span>
      </label>
  </div>
</div><footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/laravel/">Laravel</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/%E5%90%8E%E7%AB%AF/git%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Git åŸºç¡€çŸ¥è¯†</span>
            <span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span>
          </a>
        <a class="next" href="/post/database/mysql%E4%BA%8B%E5%8A%A1%E5%92%8C%E9%94%81/">
            <span class="next-text nav-default">Mysql äº‹åŠ¡å’Œé”</span>
            <span class="next-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js" crossorigin="anonymous"></script>
    <script type="text/javascript">
      var gitalk = new Gitalk({
        id: '2019-09-04 14:28:22 \u002b0800 CST',
        title: 'Laravel å®šæ—¶ä»»åŠ¡ä¸å¸¸é©»è¿›ç¨‹',
        clientID: 'fe63c88fe7fc18e38512',
        clientSecret: 'e44ced40487d261a6006f9af23a2f788bf1e0a85',
        repo: 'zsmhub.github.io',
        owner: 'zsmhub',
        admin: ['zsmhub'],
        body: decodeURI(location.href)
      });
      gitalk.render('gitalk-container');
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/gitalk/gitalk">comments powered by gitalk.</a></noscript>

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:zhangshimiande@email.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/zsmhub" class="iconfont icon-github" title="github"></a>
  <a href="https://zsmhub.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    ç”± <a class="hexo-link" href="https://gohugo.io">Hugo</a> å¼ºåŠ›é©±åŠ¨
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    ä¸»é¢˜ - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2019 - 
    2022
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">ZsmHub</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.cddea96674a99fd8cea50d36fb19d9c91f497feea4af5ce4596afd2dbaab9202.js"></script>








</body>
</html>
