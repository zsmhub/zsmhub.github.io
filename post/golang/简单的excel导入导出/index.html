<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>简单的excel导入导出 - ZsmHub - Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="" /><meta name="description" content="excel导入导出代码 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 package tool import ( &#34;errors&#34; &#34;github.com/360EntSecGroup-Skylar/excelize/v2&#34; &#34;mime/multipart&#34; &#34;strconv&#34; ) const ( maxCharCount = 26 // maxCharCount 最多26个字符A-Z defaultSheetName = &#34;Sheet1&#34; // 默认Sheet名称 ) type Excel struct { SheetName string // sheetName，默认为Sheet1 Headers []string // 表头 Rows [][]interface{} // 表数据 } func (m *Excel) SetDefaultSheetName() { if m.SheetName == &#34;&#34; { m.SheetName = defaultSheetName } } // 从文件流读取 Excel Sheet1 的所有数据 func (Excel) ReadExcelFromStream(f *multipart.FileHeader) ([][]string, error) { var rows [][]string src, err := f.Open() if err != nil { return rows, err } defer src.Close() // 兆字节转为字节进行比较大小 maxFileSize := int64(2) // 默认最大上传 2 M if f.Size &gt; maxFileSize*1e6 { return rows, errors.New(&#34;文件大小不能超过 &#34; &#43; strconv.FormatInt(maxFileSize, 10) &#43; &#34; M&#34;) } ff, err := excelize.OpenReader(src) if err != nil { if err.Error() == &#34;zip: not a valid zip file&#34; { return rows, errors.New(&#34;无效文件，注意不支持加密的EXCEL文件&#34;) } return rows, errors.New(err.Error()) } // 获取 Sheet1 上所有单元格 rows, err = ff.GetRows(ff.GetSheetName(0)) if err != nil { return rows, errors.New(err.Error()) } return rows, nil } // 导出excel到浏览器 func (m Excel) ExportToWeb() ([]byte, error) { f, err := m.exportExcel() if err != nil { return nil, err } buffer, err := f.WriteToBuffer() if err != nil { return nil, err } return buffer.Bytes(), nil } // 导出excel到本地服务器 // path 文件导出路径，建议使用绝对路径 // filename 文件名，需带上后缀 func (m Excel) ExportToPath(path, filename string) (string, error) { var filePath string f, err := m.exportExcel() if err != nil { return filePath, err } filePath = path &#43; &#34;/&#34; &#43; filename if err := f.SaveAs(filePath); err != nil { return filePath, err } return filePath, nil } // exportExcel 导出Excel文件 // sheetName 工作表名称 // headers 列名切片， 表头 // rows 数据切片，是一个二维数组 func (m Excel) exportExcel() (*excelize.File, error) { m.SetDefaultSheetName() f := excelize.NewFile() sheetIndex := f.NewSheet(m.SheetName) maxColumnRowNameLen := 1 &#43; len(strconv.Itoa(len(m.Rows))) columnCount := len(m.Headers) if columnCount &gt; maxCharCount { maxColumnRowNameLen&#43;&#43; } else if columnCount &gt; maxCharCount*maxCharCount { maxColumnRowNameLen &#43;= 2 } columnNames := make([][]byte, 0, columnCount) for i, header := range m.Headers { columnName := m.getColumnName(i, maxColumnRowNameLen) columnNames = append(columnNames, columnName) // 初始化excel表头，这里的index从1开始要注意 curColumnName := m.getColumnRowName(columnName, 1) err := f.SetCellValue(m.SheetName, curColumnName, header) if err != nil { return nil, err } } for rowIndex, row := range m.Rows { for columnIndex, columnName := range columnNames { // 从第二行开始 err := f.SetCellValue(m.SheetName, m.getColumnRowName(columnName, rowIndex&#43;2), row[columnIndex]) if err != nil { return nil, err } } } f.SetActiveSheet(sheetIndex) return f, nil } // getColumnName 生成列名 // Excel的列名规则是从A-Z往后排;超过Z以后用两个字母表示，比如AA,AB,AC;两个字母不够以后用三个字母表示，比如AAA,AAB,AAC // 这里做数字到列名的映射：0 -&gt; A, 1 -&gt; B, 2 -&gt; C // maxColumnRowNameLen 表示名称框的最大长度，假设数据是10行，1000列，则最后一个名称框是J1000(如果有表头，则是J1001),是4位 // 这里根据 maxColumnRowNameLen 生成切片，后面生成名称框的时候可以复用这个切片，而无需扩容 func (m Excel) getColumnName(column, maxColumnRowNameLen int) []byte { const A = &#39;A&#39; if column &lt; maxCharCount { // 第一次就分配好切片的容量 slice := make([]byte, 0, maxColumnRowNameLen) return append(slice, byte(A&#43;column)) } else { // 递归生成类似AA,AB,AAA,AAB这种形式的列名 return append(m.getColumnName(column/maxCharCount-1, maxColumnRowNameLen), byte(A&#43;column%maxCharCount)) } } // getColumnRowName 生成名称框 // Excel的名称框是用A1,A2,B1,B2来表示的，这里需要传入前一步生成的列名切片，然后直接加上行索引来生成名称框，就无需每次分配内存 func (Excel) getColumnRowName(columnName []byte, rowIndex int) (columnRowName string) { l := len(columnName) columnName = strconv.AppendInt(columnName, int64(rowIndex), 10) columnRowName = string(columnName) // 将列名恢复回去 columnName = columnName[:l] return } WEB端调用示例 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 package controller import ( &#34;bytes&#34; &#34;github.com/labstack/echo/v4&#34; &#34;xxx/lib/tool&#34; &#34;net/http&#34; ) type xxxController struct{} var XxxController = new(xxxController) func init() { Router.GET(&#34;/export&#34;, AuthCorpController.Export).Name = &#34;导出excel&#34; } func (xxxController) Export(c echo.Context) error { var ( excelHeaders = []string{&#34;姓名&#34;, &#34;性别&#34;, &#34;年龄&#34;} excelRows = [][]interface{}{ {&#34;张三&#34;, &#34;女&#34;, 18}, {&#34;李四&#34;, &#34;男&#34;, 19}, } ) b, _ := tool.Excel{Headers: excelHeaders, Rows: excelRows}.ExportToWeb() c.Response().Header().Set(echo.HeaderContentDisposition, &#34;attachment; filename=students.xlsx&#34;) return c.Stream(http.StatusOK, echo.MIMEOctetStream, bytes.NewReader(b)) } csv导入 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 package tool import ( &#34;bufio&#34; &#34;bytes&#34; &#34;encoding/csv&#34; &#34;errors&#34; &#34;golang.org/x/text/encoding/simplifiedchinese&#34; &#34;golang.org/x/text/transform&#34; &#34;io&#34; &#34;mime/multipart&#34; &#34;strconv&#34; &#34;strings&#34; ) type Csv struct{} // 从文件流读取 csv 的所有数据 func (m Csv) ReadCsvFromStream(f *multipart.FileHeader) ([][]string, error) { var rows [][]string src, err := f.Open() if err != nil { return rows, err } defer src.Close() // 兆字节转为字节进行比较大小 maxFileSize := int64(2) // 默认最大上传 2 M if f.Size &gt; maxFileSize*1e6 { return rows, errors.New(&#34;文件大小不能超过 &#34; &#43; strconv.FormatInt(maxFileSize, 10) &#43; &#34; M&#34;) } // 初始化一个 csv reader，并通过这个 reader 从 csv 文件读取数据 reader := csv.NewReader(transform.NewReader(bufio.NewReader(src), simplifiedchinese.GBK.NewDecoder())) // 设置返回记录中每行数据期望的字段数，-1 表示返回所有字段 reader.FieldsPerRecord = -1 // 通过 readAll 方法返回 csv 文件中的所有内容 rows, err = reader.ReadAll() if err != nil { return rows, err } return rows, nil } // 从文件流读取不规范 csv 的所有数据 func (m Csv) ReadIllegalCsvFromSteam(f *multipart.FileHeader) ([][]string, error) { var rows [][]string src, err := f.Open() if err != nil { return rows, err } defer src.Close() // 兆字节转为字节进行比较大小 maxFileSize := int64(2) // 默认最大上传 2 M if f.Size &gt; maxFileSize*1e6 { return rows, errors.New(&#34;文件大小不能超过 &#34; &#43; strconv.FormatInt(maxFileSize, 10) &#43; &#34; M&#34;) } // 直接复制文件内容 var buf bytes.Buffer if _, err = io.Copy(&amp;buf, transform.NewReader(bufio.NewReader(src), simplifiedchinese.GBK.NewDecoder())); err != nil { return rows, err } contents := buf.String() slice := strings.Split(contents, &#34;\n&#34;) for _, v := range slice { records := strings.Split(strings.ReplaceAll(v, &#34;=\&#34;&#34;, &#34;\&#34;&#34;), &#34;,&#34;) // 去掉不合法的等号 for kk, vv := range records { records[kk] = strings.Trim(vv, &#34;\&#34;&#34;) // 去除前后的双引号 } rows = append(rows, records) } return rows, nil } " /><meta name="keywords" content="Hugo, even, zsmhub, blog, php, golang" />






<meta name="generator" content="Hugo 0.146.4 with theme even" />


<link rel="canonical" href="https://zsmhub.github.io/post/golang/%E7%AE%80%E5%8D%95%E7%9A%84excel%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:url" content="https://zsmhub.github.io/post/golang/%E7%AE%80%E5%8D%95%E7%9A%84excel%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA/">
  <meta property="og:site_name" content="ZsmHub - Blog">
  <meta property="og:title" content="简单的excel导入导出">
  <meta property="og:description" content="excel导入导出代码 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 package tool import ( &#34;errors&#34; &#34;github.com/360EntSecGroup-Skylar/excelize/v2&#34; &#34;mime/multipart&#34; &#34;strconv&#34; ) const ( maxCharCount = 26 // maxCharCount 最多26个字符A-Z defaultSheetName = &#34;Sheet1&#34; // 默认Sheet名称 ) type Excel struct { SheetName string // sheetName，默认为Sheet1 Headers []string // 表头 Rows [][]interface{} // 表数据 } func (m *Excel) SetDefaultSheetName() { if m.SheetName == &#34;&#34; { m.SheetName = defaultSheetName } } // 从文件流读取 Excel Sheet1 的所有数据 func (Excel) ReadExcelFromStream(f *multipart.FileHeader) ([][]string, error) { var rows [][]string src, err := f.Open() if err != nil { return rows, err } defer src.Close() // 兆字节转为字节进行比较大小 maxFileSize := int64(2) // 默认最大上传 2 M if f.Size &gt; maxFileSize*1e6 { return rows, errors.New(&#34;文件大小不能超过 &#34; &#43; strconv.FormatInt(maxFileSize, 10) &#43; &#34; M&#34;) } ff, err := excelize.OpenReader(src) if err != nil { if err.Error() == &#34;zip: not a valid zip file&#34; { return rows, errors.New(&#34;无效文件，注意不支持加密的EXCEL文件&#34;) } return rows, errors.New(err.Error()) } // 获取 Sheet1 上所有单元格 rows, err = ff.GetRows(ff.GetSheetName(0)) if err != nil { return rows, errors.New(err.Error()) } return rows, nil } // 导出excel到浏览器 func (m Excel) ExportToWeb() ([]byte, error) { f, err := m.exportExcel() if err != nil { return nil, err } buffer, err := f.WriteToBuffer() if err != nil { return nil, err } return buffer.Bytes(), nil } // 导出excel到本地服务器 // path 文件导出路径，建议使用绝对路径 // filename 文件名，需带上后缀 func (m Excel) ExportToPath(path, filename string) (string, error) { var filePath string f, err := m.exportExcel() if err != nil { return filePath, err } filePath = path &#43; &#34;/&#34; &#43; filename if err := f.SaveAs(filePath); err != nil { return filePath, err } return filePath, nil } // exportExcel 导出Excel文件 // sheetName 工作表名称 // headers 列名切片， 表头 // rows 数据切片，是一个二维数组 func (m Excel) exportExcel() (*excelize.File, error) { m.SetDefaultSheetName() f := excelize.NewFile() sheetIndex := f.NewSheet(m.SheetName) maxColumnRowNameLen := 1 &#43; len(strconv.Itoa(len(m.Rows))) columnCount := len(m.Headers) if columnCount &gt; maxCharCount { maxColumnRowNameLen&#43;&#43; } else if columnCount &gt; maxCharCount*maxCharCount { maxColumnRowNameLen &#43;= 2 } columnNames := make([][]byte, 0, columnCount) for i, header := range m.Headers { columnName := m.getColumnName(i, maxColumnRowNameLen) columnNames = append(columnNames, columnName) // 初始化excel表头，这里的index从1开始要注意 curColumnName := m.getColumnRowName(columnName, 1) err := f.SetCellValue(m.SheetName, curColumnName, header) if err != nil { return nil, err } } for rowIndex, row := range m.Rows { for columnIndex, columnName := range columnNames { // 从第二行开始 err := f.SetCellValue(m.SheetName, m.getColumnRowName(columnName, rowIndex&#43;2), row[columnIndex]) if err != nil { return nil, err } } } f.SetActiveSheet(sheetIndex) return f, nil } // getColumnName 生成列名 // Excel的列名规则是从A-Z往后排;超过Z以后用两个字母表示，比如AA,AB,AC;两个字母不够以后用三个字母表示，比如AAA,AAB,AAC // 这里做数字到列名的映射：0 -&gt; A, 1 -&gt; B, 2 -&gt; C // maxColumnRowNameLen 表示名称框的最大长度，假设数据是10行，1000列，则最后一个名称框是J1000(如果有表头，则是J1001),是4位 // 这里根据 maxColumnRowNameLen 生成切片，后面生成名称框的时候可以复用这个切片，而无需扩容 func (m Excel) getColumnName(column, maxColumnRowNameLen int) []byte { const A = &#39;A&#39; if column &lt; maxCharCount { // 第一次就分配好切片的容量 slice := make([]byte, 0, maxColumnRowNameLen) return append(slice, byte(A&#43;column)) } else { // 递归生成类似AA,AB,AAA,AAB这种形式的列名 return append(m.getColumnName(column/maxCharCount-1, maxColumnRowNameLen), byte(A&#43;column%maxCharCount)) } } // getColumnRowName 生成名称框 // Excel的名称框是用A1,A2,B1,B2来表示的，这里需要传入前一步生成的列名切片，然后直接加上行索引来生成名称框，就无需每次分配内存 func (Excel) getColumnRowName(columnName []byte, rowIndex int) (columnRowName string) { l := len(columnName) columnName = strconv.AppendInt(columnName, int64(rowIndex), 10) columnRowName = string(columnName) // 将列名恢复回去 columnName = columnName[:l] return } WEB端调用示例 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 package controller import ( &#34;bytes&#34; &#34;github.com/labstack/echo/v4&#34; &#34;xxx/lib/tool&#34; &#34;net/http&#34; ) type xxxController struct{} var XxxController = new(xxxController) func init() { Router.GET(&#34;/export&#34;, AuthCorpController.Export).Name = &#34;导出excel&#34; } func (xxxController) Export(c echo.Context) error { var ( excelHeaders = []string{&#34;姓名&#34;, &#34;性别&#34;, &#34;年龄&#34;} excelRows = [][]interface{}{ {&#34;张三&#34;, &#34;女&#34;, 18}, {&#34;李四&#34;, &#34;男&#34;, 19}, } ) b, _ := tool.Excel{Headers: excelHeaders, Rows: excelRows}.ExportToWeb() c.Response().Header().Set(echo.HeaderContentDisposition, &#34;attachment; filename=students.xlsx&#34;) return c.Stream(http.StatusOK, echo.MIMEOctetStream, bytes.NewReader(b)) } csv导入 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 package tool import ( &#34;bufio&#34; &#34;bytes&#34; &#34;encoding/csv&#34; &#34;errors&#34; &#34;golang.org/x/text/encoding/simplifiedchinese&#34; &#34;golang.org/x/text/transform&#34; &#34;io&#34; &#34;mime/multipart&#34; &#34;strconv&#34; &#34;strings&#34; ) type Csv struct{} // 从文件流读取 csv 的所有数据 func (m Csv) ReadCsvFromStream(f *multipart.FileHeader) ([][]string, error) { var rows [][]string src, err := f.Open() if err != nil { return rows, err } defer src.Close() // 兆字节转为字节进行比较大小 maxFileSize := int64(2) // 默认最大上传 2 M if f.Size &gt; maxFileSize*1e6 { return rows, errors.New(&#34;文件大小不能超过 &#34; &#43; strconv.FormatInt(maxFileSize, 10) &#43; &#34; M&#34;) } // 初始化一个 csv reader，并通过这个 reader 从 csv 文件读取数据 reader := csv.NewReader(transform.NewReader(bufio.NewReader(src), simplifiedchinese.GBK.NewDecoder())) // 设置返回记录中每行数据期望的字段数，-1 表示返回所有字段 reader.FieldsPerRecord = -1 // 通过 readAll 方法返回 csv 文件中的所有内容 rows, err = reader.ReadAll() if err != nil { return rows, err } return rows, nil } // 从文件流读取不规范 csv 的所有数据 func (m Csv) ReadIllegalCsvFromSteam(f *multipart.FileHeader) ([][]string, error) { var rows [][]string src, err := f.Open() if err != nil { return rows, err } defer src.Close() // 兆字节转为字节进行比较大小 maxFileSize := int64(2) // 默认最大上传 2 M if f.Size &gt; maxFileSize*1e6 { return rows, errors.New(&#34;文件大小不能超过 &#34; &#43; strconv.FormatInt(maxFileSize, 10) &#43; &#34; M&#34;) } // 直接复制文件内容 var buf bytes.Buffer if _, err = io.Copy(&amp;buf, transform.NewReader(bufio.NewReader(src), simplifiedchinese.GBK.NewDecoder())); err != nil { return rows, err } contents := buf.String() slice := strings.Split(contents, &#34;\n&#34;) for _, v := range slice { records := strings.Split(strings.ReplaceAll(v, &#34;=\&#34;&#34;, &#34;\&#34;&#34;), &#34;,&#34;) // 去掉不合法的等号 for kk, vv := range records { records[kk] = strings.Trim(vv, &#34;\&#34;&#34;) // 去除前后的双引号 } rows = append(rows, records) } return rows, nil }">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2022-03-16T15:41:12+08:00">
    <meta property="article:modified_time" content="2022-03-16T15:41:12+08:00">
    <meta property="article:tag" content="Excel">
    <meta property="article:tag" content="Excelize">

  <meta itemprop="name" content="简单的excel导入导出">
  <meta itemprop="description" content="excel导入导出代码 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 package tool import ( &#34;errors&#34; &#34;github.com/360EntSecGroup-Skylar/excelize/v2&#34; &#34;mime/multipart&#34; &#34;strconv&#34; ) const ( maxCharCount = 26 // maxCharCount 最多26个字符A-Z defaultSheetName = &#34;Sheet1&#34; // 默认Sheet名称 ) type Excel struct { SheetName string // sheetName，默认为Sheet1 Headers []string // 表头 Rows [][]interface{} // 表数据 } func (m *Excel) SetDefaultSheetName() { if m.SheetName == &#34;&#34; { m.SheetName = defaultSheetName } } // 从文件流读取 Excel Sheet1 的所有数据 func (Excel) ReadExcelFromStream(f *multipart.FileHeader) ([][]string, error) { var rows [][]string src, err := f.Open() if err != nil { return rows, err } defer src.Close() // 兆字节转为字节进行比较大小 maxFileSize := int64(2) // 默认最大上传 2 M if f.Size &gt; maxFileSize*1e6 { return rows, errors.New(&#34;文件大小不能超过 &#34; &#43; strconv.FormatInt(maxFileSize, 10) &#43; &#34; M&#34;) } ff, err := excelize.OpenReader(src) if err != nil { if err.Error() == &#34;zip: not a valid zip file&#34; { return rows, errors.New(&#34;无效文件，注意不支持加密的EXCEL文件&#34;) } return rows, errors.New(err.Error()) } // 获取 Sheet1 上所有单元格 rows, err = ff.GetRows(ff.GetSheetName(0)) if err != nil { return rows, errors.New(err.Error()) } return rows, nil } // 导出excel到浏览器 func (m Excel) ExportToWeb() ([]byte, error) { f, err := m.exportExcel() if err != nil { return nil, err } buffer, err := f.WriteToBuffer() if err != nil { return nil, err } return buffer.Bytes(), nil } // 导出excel到本地服务器 // path 文件导出路径，建议使用绝对路径 // filename 文件名，需带上后缀 func (m Excel) ExportToPath(path, filename string) (string, error) { var filePath string f, err := m.exportExcel() if err != nil { return filePath, err } filePath = path &#43; &#34;/&#34; &#43; filename if err := f.SaveAs(filePath); err != nil { return filePath, err } return filePath, nil } // exportExcel 导出Excel文件 // sheetName 工作表名称 // headers 列名切片， 表头 // rows 数据切片，是一个二维数组 func (m Excel) exportExcel() (*excelize.File, error) { m.SetDefaultSheetName() f := excelize.NewFile() sheetIndex := f.NewSheet(m.SheetName) maxColumnRowNameLen := 1 &#43; len(strconv.Itoa(len(m.Rows))) columnCount := len(m.Headers) if columnCount &gt; maxCharCount { maxColumnRowNameLen&#43;&#43; } else if columnCount &gt; maxCharCount*maxCharCount { maxColumnRowNameLen &#43;= 2 } columnNames := make([][]byte, 0, columnCount) for i, header := range m.Headers { columnName := m.getColumnName(i, maxColumnRowNameLen) columnNames = append(columnNames, columnName) // 初始化excel表头，这里的index从1开始要注意 curColumnName := m.getColumnRowName(columnName, 1) err := f.SetCellValue(m.SheetName, curColumnName, header) if err != nil { return nil, err } } for rowIndex, row := range m.Rows { for columnIndex, columnName := range columnNames { // 从第二行开始 err := f.SetCellValue(m.SheetName, m.getColumnRowName(columnName, rowIndex&#43;2), row[columnIndex]) if err != nil { return nil, err } } } f.SetActiveSheet(sheetIndex) return f, nil } // getColumnName 生成列名 // Excel的列名规则是从A-Z往后排;超过Z以后用两个字母表示，比如AA,AB,AC;两个字母不够以后用三个字母表示，比如AAA,AAB,AAC // 这里做数字到列名的映射：0 -&gt; A, 1 -&gt; B, 2 -&gt; C // maxColumnRowNameLen 表示名称框的最大长度，假设数据是10行，1000列，则最后一个名称框是J1000(如果有表头，则是J1001),是4位 // 这里根据 maxColumnRowNameLen 生成切片，后面生成名称框的时候可以复用这个切片，而无需扩容 func (m Excel) getColumnName(column, maxColumnRowNameLen int) []byte { const A = &#39;A&#39; if column &lt; maxCharCount { // 第一次就分配好切片的容量 slice := make([]byte, 0, maxColumnRowNameLen) return append(slice, byte(A&#43;column)) } else { // 递归生成类似AA,AB,AAA,AAB这种形式的列名 return append(m.getColumnName(column/maxCharCount-1, maxColumnRowNameLen), byte(A&#43;column%maxCharCount)) } } // getColumnRowName 生成名称框 // Excel的名称框是用A1,A2,B1,B2来表示的，这里需要传入前一步生成的列名切片，然后直接加上行索引来生成名称框，就无需每次分配内存 func (Excel) getColumnRowName(columnName []byte, rowIndex int) (columnRowName string) { l := len(columnName) columnName = strconv.AppendInt(columnName, int64(rowIndex), 10) columnRowName = string(columnName) // 将列名恢复回去 columnName = columnName[:l] return } WEB端调用示例 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 package controller import ( &#34;bytes&#34; &#34;github.com/labstack/echo/v4&#34; &#34;xxx/lib/tool&#34; &#34;net/http&#34; ) type xxxController struct{} var XxxController = new(xxxController) func init() { Router.GET(&#34;/export&#34;, AuthCorpController.Export).Name = &#34;导出excel&#34; } func (xxxController) Export(c echo.Context) error { var ( excelHeaders = []string{&#34;姓名&#34;, &#34;性别&#34;, &#34;年龄&#34;} excelRows = [][]interface{}{ {&#34;张三&#34;, &#34;女&#34;, 18}, {&#34;李四&#34;, &#34;男&#34;, 19}, } ) b, _ := tool.Excel{Headers: excelHeaders, Rows: excelRows}.ExportToWeb() c.Response().Header().Set(echo.HeaderContentDisposition, &#34;attachment; filename=students.xlsx&#34;) return c.Stream(http.StatusOK, echo.MIMEOctetStream, bytes.NewReader(b)) } csv导入 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 package tool import ( &#34;bufio&#34; &#34;bytes&#34; &#34;encoding/csv&#34; &#34;errors&#34; &#34;golang.org/x/text/encoding/simplifiedchinese&#34; &#34;golang.org/x/text/transform&#34; &#34;io&#34; &#34;mime/multipart&#34; &#34;strconv&#34; &#34;strings&#34; ) type Csv struct{} // 从文件流读取 csv 的所有数据 func (m Csv) ReadCsvFromStream(f *multipart.FileHeader) ([][]string, error) { var rows [][]string src, err := f.Open() if err != nil { return rows, err } defer src.Close() // 兆字节转为字节进行比较大小 maxFileSize := int64(2) // 默认最大上传 2 M if f.Size &gt; maxFileSize*1e6 { return rows, errors.New(&#34;文件大小不能超过 &#34; &#43; strconv.FormatInt(maxFileSize, 10) &#43; &#34; M&#34;) } // 初始化一个 csv reader，并通过这个 reader 从 csv 文件读取数据 reader := csv.NewReader(transform.NewReader(bufio.NewReader(src), simplifiedchinese.GBK.NewDecoder())) // 设置返回记录中每行数据期望的字段数，-1 表示返回所有字段 reader.FieldsPerRecord = -1 // 通过 readAll 方法返回 csv 文件中的所有内容 rows, err = reader.ReadAll() if err != nil { return rows, err } return rows, nil } // 从文件流读取不规范 csv 的所有数据 func (m Csv) ReadIllegalCsvFromSteam(f *multipart.FileHeader) ([][]string, error) { var rows [][]string src, err := f.Open() if err != nil { return rows, err } defer src.Close() // 兆字节转为字节进行比较大小 maxFileSize := int64(2) // 默认最大上传 2 M if f.Size &gt; maxFileSize*1e6 { return rows, errors.New(&#34;文件大小不能超过 &#34; &#43; strconv.FormatInt(maxFileSize, 10) &#43; &#34; M&#34;) } // 直接复制文件内容 var buf bytes.Buffer if _, err = io.Copy(&amp;buf, transform.NewReader(bufio.NewReader(src), simplifiedchinese.GBK.NewDecoder())); err != nil { return rows, err } contents := buf.String() slice := strings.Split(contents, &#34;\n&#34;) for _, v := range slice { records := strings.Split(strings.ReplaceAll(v, &#34;=\&#34;&#34;, &#34;\&#34;&#34;), &#34;,&#34;) // 去掉不合法的等号 for kk, vv := range records { records[kk] = strings.Trim(vv, &#34;\&#34;&#34;) // 去除前后的双引号 } rows = append(rows, records) } return rows, nil }">
  <meta itemprop="datePublished" content="2022-03-16T15:41:12+08:00">
  <meta itemprop="dateModified" content="2022-03-16T15:41:12+08:00">
  <meta itemprop="wordCount" content="1874">
  <meta itemprop="keywords" content="Excel,Excelize">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="简单的excel导入导出">
  <meta name="twitter:description" content="excel导入导出代码 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 package tool import ( &#34;errors&#34; &#34;github.com/360EntSecGroup-Skylar/excelize/v2&#34; &#34;mime/multipart&#34; &#34;strconv&#34; ) const ( maxCharCount = 26 // maxCharCount 最多26个字符A-Z defaultSheetName = &#34;Sheet1&#34; // 默认Sheet名称 ) type Excel struct { SheetName string // sheetName，默认为Sheet1 Headers []string // 表头 Rows [][]interface{} // 表数据 } func (m *Excel) SetDefaultSheetName() { if m.SheetName == &#34;&#34; { m.SheetName = defaultSheetName } } // 从文件流读取 Excel Sheet1 的所有数据 func (Excel) ReadExcelFromStream(f *multipart.FileHeader) ([][]string, error) { var rows [][]string src, err := f.Open() if err != nil { return rows, err } defer src.Close() // 兆字节转为字节进行比较大小 maxFileSize := int64(2) // 默认最大上传 2 M if f.Size &gt; maxFileSize*1e6 { return rows, errors.New(&#34;文件大小不能超过 &#34; &#43; strconv.FormatInt(maxFileSize, 10) &#43; &#34; M&#34;) } ff, err := excelize.OpenReader(src) if err != nil { if err.Error() == &#34;zip: not a valid zip file&#34; { return rows, errors.New(&#34;无效文件，注意不支持加密的EXCEL文件&#34;) } return rows, errors.New(err.Error()) } // 获取 Sheet1 上所有单元格 rows, err = ff.GetRows(ff.GetSheetName(0)) if err != nil { return rows, errors.New(err.Error()) } return rows, nil } // 导出excel到浏览器 func (m Excel) ExportToWeb() ([]byte, error) { f, err := m.exportExcel() if err != nil { return nil, err } buffer, err := f.WriteToBuffer() if err != nil { return nil, err } return buffer.Bytes(), nil } // 导出excel到本地服务器 // path 文件导出路径，建议使用绝对路径 // filename 文件名，需带上后缀 func (m Excel) ExportToPath(path, filename string) (string, error) { var filePath string f, err := m.exportExcel() if err != nil { return filePath, err } filePath = path &#43; &#34;/&#34; &#43; filename if err := f.SaveAs(filePath); err != nil { return filePath, err } return filePath, nil } // exportExcel 导出Excel文件 // sheetName 工作表名称 // headers 列名切片， 表头 // rows 数据切片，是一个二维数组 func (m Excel) exportExcel() (*excelize.File, error) { m.SetDefaultSheetName() f := excelize.NewFile() sheetIndex := f.NewSheet(m.SheetName) maxColumnRowNameLen := 1 &#43; len(strconv.Itoa(len(m.Rows))) columnCount := len(m.Headers) if columnCount &gt; maxCharCount { maxColumnRowNameLen&#43;&#43; } else if columnCount &gt; maxCharCount*maxCharCount { maxColumnRowNameLen &#43;= 2 } columnNames := make([][]byte, 0, columnCount) for i, header := range m.Headers { columnName := m.getColumnName(i, maxColumnRowNameLen) columnNames = append(columnNames, columnName) // 初始化excel表头，这里的index从1开始要注意 curColumnName := m.getColumnRowName(columnName, 1) err := f.SetCellValue(m.SheetName, curColumnName, header) if err != nil { return nil, err } } for rowIndex, row := range m.Rows { for columnIndex, columnName := range columnNames { // 从第二行开始 err := f.SetCellValue(m.SheetName, m.getColumnRowName(columnName, rowIndex&#43;2), row[columnIndex]) if err != nil { return nil, err } } } f.SetActiveSheet(sheetIndex) return f, nil } // getColumnName 生成列名 // Excel的列名规则是从A-Z往后排;超过Z以后用两个字母表示，比如AA,AB,AC;两个字母不够以后用三个字母表示，比如AAA,AAB,AAC // 这里做数字到列名的映射：0 -&gt; A, 1 -&gt; B, 2 -&gt; C // maxColumnRowNameLen 表示名称框的最大长度，假设数据是10行，1000列，则最后一个名称框是J1000(如果有表头，则是J1001),是4位 // 这里根据 maxColumnRowNameLen 生成切片，后面生成名称框的时候可以复用这个切片，而无需扩容 func (m Excel) getColumnName(column, maxColumnRowNameLen int) []byte { const A = &#39;A&#39; if column &lt; maxCharCount { // 第一次就分配好切片的容量 slice := make([]byte, 0, maxColumnRowNameLen) return append(slice, byte(A&#43;column)) } else { // 递归生成类似AA,AB,AAA,AAB这种形式的列名 return append(m.getColumnName(column/maxCharCount-1, maxColumnRowNameLen), byte(A&#43;column%maxCharCount)) } } // getColumnRowName 生成名称框 // Excel的名称框是用A1,A2,B1,B2来表示的，这里需要传入前一步生成的列名切片，然后直接加上行索引来生成名称框，就无需每次分配内存 func (Excel) getColumnRowName(columnName []byte, rowIndex int) (columnRowName string) { l := len(columnName) columnName = strconv.AppendInt(columnName, int64(rowIndex), 10) columnRowName = string(columnName) // 将列名恢复回去 columnName = columnName[:l] return } WEB端调用示例 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 package controller import ( &#34;bytes&#34; &#34;github.com/labstack/echo/v4&#34; &#34;xxx/lib/tool&#34; &#34;net/http&#34; ) type xxxController struct{} var XxxController = new(xxxController) func init() { Router.GET(&#34;/export&#34;, AuthCorpController.Export).Name = &#34;导出excel&#34; } func (xxxController) Export(c echo.Context) error { var ( excelHeaders = []string{&#34;姓名&#34;, &#34;性别&#34;, &#34;年龄&#34;} excelRows = [][]interface{}{ {&#34;张三&#34;, &#34;女&#34;, 18}, {&#34;李四&#34;, &#34;男&#34;, 19}, } ) b, _ := tool.Excel{Headers: excelHeaders, Rows: excelRows}.ExportToWeb() c.Response().Header().Set(echo.HeaderContentDisposition, &#34;attachment; filename=students.xlsx&#34;) return c.Stream(http.StatusOK, echo.MIMEOctetStream, bytes.NewReader(b)) } csv导入 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 package tool import ( &#34;bufio&#34; &#34;bytes&#34; &#34;encoding/csv&#34; &#34;errors&#34; &#34;golang.org/x/text/encoding/simplifiedchinese&#34; &#34;golang.org/x/text/transform&#34; &#34;io&#34; &#34;mime/multipart&#34; &#34;strconv&#34; &#34;strings&#34; ) type Csv struct{} // 从文件流读取 csv 的所有数据 func (m Csv) ReadCsvFromStream(f *multipart.FileHeader) ([][]string, error) { var rows [][]string src, err := f.Open() if err != nil { return rows, err } defer src.Close() // 兆字节转为字节进行比较大小 maxFileSize := int64(2) // 默认最大上传 2 M if f.Size &gt; maxFileSize*1e6 { return rows, errors.New(&#34;文件大小不能超过 &#34; &#43; strconv.FormatInt(maxFileSize, 10) &#43; &#34; M&#34;) } // 初始化一个 csv reader，并通过这个 reader 从 csv 文件读取数据 reader := csv.NewReader(transform.NewReader(bufio.NewReader(src), simplifiedchinese.GBK.NewDecoder())) // 设置返回记录中每行数据期望的字段数，-1 表示返回所有字段 reader.FieldsPerRecord = -1 // 通过 readAll 方法返回 csv 文件中的所有内容 rows, err = reader.ReadAll() if err != nil { return rows, err } return rows, nil } // 从文件流读取不规范 csv 的所有数据 func (m Csv) ReadIllegalCsvFromSteam(f *multipart.FileHeader) ([][]string, error) { var rows [][]string src, err := f.Open() if err != nil { return rows, err } defer src.Close() // 兆字节转为字节进行比较大小 maxFileSize := int64(2) // 默认最大上传 2 M if f.Size &gt; maxFileSize*1e6 { return rows, errors.New(&#34;文件大小不能超过 &#34; &#43; strconv.FormatInt(maxFileSize, 10) &#43; &#34; M&#34;) } // 直接复制文件内容 var buf bytes.Buffer if _, err = io.Copy(&amp;buf, transform.NewReader(bufio.NewReader(src), simplifiedchinese.GBK.NewDecoder())); err != nil { return rows, err } contents := buf.String() slice := strings.Split(contents, &#34;\n&#34;) for _, v := range slice { records := strings.Split(strings.ReplaceAll(v, &#34;=\&#34;&#34;, &#34;\&#34;&#34;), &#34;,&#34;) // 去掉不合法的等号 for kk, vv := range records { records[kk] = strings.Trim(vv, &#34;\&#34;&#34;) // 去除前后的双引号 } rows = append(rows, records) } return rows, nil }">

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">ZsmHub Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">首页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">分类</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="/navigation">
        <li class="mobile-menu-item">导航</li>
      </a><a href="/about">
        <li class="mobile-menu-item">关于</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">ZsmHub Blog</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">首页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">分类</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/navigation">导航</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about">关于</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">简单的excel导入导出</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-03-16 </span>
        <div class="post-category">
            <a href="/categories/golang/"> golang </a>
            </div>
          <span class="more-meta"> 约 1874 字 </span>
          <span class="more-meta"> 预计阅读 4 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#excel导入导出代码">excel导入导出代码</a></li>
    <li><a href="#web端调用示例">WEB端调用示例</a></li>
    <li><a href="#csv导入">csv导入</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="excel导入导出代码">excel导入导出代码</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">tool</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;errors&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;github.com/360EntSecGroup-Skylar/excelize/v2&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;mime/multipart&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;strconv&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">const</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">maxCharCount</span>     <span class="p">=</span> <span class="mi">26</span>       <span class="c1">// maxCharCount 最多26个字符A-Z</span>
</span></span><span class="line"><span class="cl">    <span class="nx">defaultSheetName</span> <span class="p">=</span> <span class="s">&#34;Sheet1&#34;</span> <span class="c1">// 默认Sheet名称</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Excel</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">SheetName</span> <span class="kt">string</span>          <span class="c1">// sheetName，默认为Sheet1</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Headers</span>   <span class="p">[]</span><span class="kt">string</span>        <span class="c1">// 表头</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Rows</span>      <span class="p">[][]</span><span class="kd">interface</span><span class="p">{}</span> <span class="c1">// 表数据</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">Excel</span><span class="p">)</span> <span class="nf">SetDefaultSheetName</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">m</span><span class="p">.</span><span class="nx">SheetName</span> <span class="o">==</span> <span class="s">&#34;&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">m</span><span class="p">.</span><span class="nx">SheetName</span> <span class="p">=</span> <span class="nx">defaultSheetName</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 从文件流读取 Excel Sheet1 的所有数据</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">Excel</span><span class="p">)</span> <span class="nf">ReadExcelFromStream</span><span class="p">(</span><span class="nx">f</span> <span class="o">*</span><span class="nx">multipart</span><span class="p">.</span><span class="nx">FileHeader</span><span class="p">)</span> <span class="p">([][]</span><span class="kt">string</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">rows</span> <span class="p">[][]</span><span class="kt">string</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">src</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">f</span><span class="p">.</span><span class="nf">Open</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">rows</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">defer</span> <span class="nx">src</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 兆字节转为字节进行比较大小</span>
</span></span><span class="line"><span class="cl">    <span class="nx">maxFileSize</span> <span class="o">:=</span> <span class="nb">int64</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1">// 默认最大上传 2 M</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">f</span><span class="p">.</span><span class="nx">Size</span> <span class="p">&gt;</span> <span class="nx">maxFileSize</span><span class="o">*</span><span class="mf">1e6</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">rows</span><span class="p">,</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;文件大小不能超过 &#34;</span> <span class="o">+</span> <span class="nx">strconv</span><span class="p">.</span><span class="nf">FormatInt</span><span class="p">(</span><span class="nx">maxFileSize</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#34; M&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">ff</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">excelize</span><span class="p">.</span><span class="nf">OpenReader</span><span class="p">(</span><span class="nx">src</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#34;zip: not a valid zip file&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">rows</span><span class="p">,</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;无效文件，注意不支持加密的EXCEL文件&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">rows</span><span class="p">,</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 获取 Sheet1 上所有单元格</span>
</span></span><span class="line"><span class="cl">    <span class="nx">rows</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">ff</span><span class="p">.</span><span class="nf">GetRows</span><span class="p">(</span><span class="nx">ff</span><span class="p">.</span><span class="nf">GetSheetName</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">rows</span><span class="p">,</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">rows</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 导出excel到浏览器</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="nx">Excel</span><span class="p">)</span> <span class="nf">ExportToWeb</span><span class="p">()</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">f</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">m</span><span class="p">.</span><span class="nf">exportExcel</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">buffer</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">f</span><span class="p">.</span><span class="nf">WriteToBuffer</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">buffer</span><span class="p">.</span><span class="nf">Bytes</span><span class="p">(),</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 导出excel到本地服务器</span>
</span></span><span class="line"><span class="cl"><span class="c1">// path 文件导出路径，建议使用绝对路径</span>
</span></span><span class="line"><span class="cl"><span class="c1">// filename 文件名，需带上后缀</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="nx">Excel</span><span class="p">)</span> <span class="nf">ExportToPath</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">filename</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">filePath</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">    <span class="nx">f</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">m</span><span class="p">.</span><span class="nf">exportExcel</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">filePath</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">filePath</span> <span class="p">=</span> <span class="nx">path</span> <span class="o">+</span> <span class="s">&#34;/&#34;</span> <span class="o">+</span> <span class="nx">filename</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">f</span><span class="p">.</span><span class="nf">SaveAs</span><span class="p">(</span><span class="nx">filePath</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">filePath</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">filePath</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// exportExcel 导出Excel文件</span>
</span></span><span class="line"><span class="cl"><span class="c1">// sheetName 工作表名称</span>
</span></span><span class="line"><span class="cl"><span class="c1">// headers 列名切片， 表头</span>
</span></span><span class="line"><span class="cl"><span class="c1">// rows 数据切片，是一个二维数组</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="nx">Excel</span><span class="p">)</span> <span class="nf">exportExcel</span><span class="p">()</span> <span class="p">(</span><span class="o">*</span><span class="nx">excelize</span><span class="p">.</span><span class="nx">File</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">m</span><span class="p">.</span><span class="nf">SetDefaultSheetName</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">f</span> <span class="o">:=</span> <span class="nx">excelize</span><span class="p">.</span><span class="nf">NewFile</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nx">sheetIndex</span> <span class="o">:=</span> <span class="nx">f</span><span class="p">.</span><span class="nf">NewSheet</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">SheetName</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">maxColumnRowNameLen</span> <span class="o">:=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="nx">strconv</span><span class="p">.</span><span class="nf">Itoa</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">Rows</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="nx">columnCount</span> <span class="o">:=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">Headers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">columnCount</span> <span class="p">&gt;</span> <span class="nx">maxCharCount</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">maxColumnRowNameLen</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">columnCount</span> <span class="p">&gt;</span> <span class="nx">maxCharCount</span><span class="o">*</span><span class="nx">maxCharCount</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">maxColumnRowNameLen</span> <span class="o">+=</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">columnNames</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([][]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">columnCount</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">header</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">m</span><span class="p">.</span><span class="nx">Headers</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">columnName</span> <span class="o">:=</span> <span class="nx">m</span><span class="p">.</span><span class="nf">getColumnName</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">maxColumnRowNameLen</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">columnNames</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">columnNames</span><span class="p">,</span> <span class="nx">columnName</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 初始化excel表头，这里的index从1开始要注意</span>
</span></span><span class="line"><span class="cl">        <span class="nx">curColumnName</span> <span class="o">:=</span> <span class="nx">m</span><span class="p">.</span><span class="nf">getColumnRowName</span><span class="p">(</span><span class="nx">columnName</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">err</span> <span class="o">:=</span> <span class="nx">f</span><span class="p">.</span><span class="nf">SetCellValue</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">SheetName</span><span class="p">,</span> <span class="nx">curColumnName</span><span class="p">,</span> <span class="nx">header</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">rowIndex</span><span class="p">,</span> <span class="nx">row</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">m</span><span class="p">.</span><span class="nx">Rows</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="nx">columnIndex</span><span class="p">,</span> <span class="nx">columnName</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">columnNames</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// 从第二行开始</span>
</span></span><span class="line"><span class="cl">            <span class="nx">err</span> <span class="o">:=</span> <span class="nx">f</span><span class="p">.</span><span class="nf">SetCellValue</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">SheetName</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nf">getColumnRowName</span><span class="p">(</span><span class="nx">columnName</span><span class="p">,</span> <span class="nx">rowIndex</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="nx">row</span><span class="p">[</span><span class="nx">columnIndex</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">f</span><span class="p">.</span><span class="nf">SetActiveSheet</span><span class="p">(</span><span class="nx">sheetIndex</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">f</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// getColumnName 生成列名</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Excel的列名规则是从A-Z往后排;超过Z以后用两个字母表示，比如AA,AB,AC;两个字母不够以后用三个字母表示，比如AAA,AAB,AAC</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 这里做数字到列名的映射：0 -&gt; A, 1 -&gt; B, 2 -&gt; C</span>
</span></span><span class="line"><span class="cl"><span class="c1">// maxColumnRowNameLen 表示名称框的最大长度，假设数据是10行，1000列，则最后一个名称框是J1000(如果有表头，则是J1001),是4位</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 这里根据 maxColumnRowNameLen 生成切片，后面生成名称框的时候可以复用这个切片，而无需扩容</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="nx">Excel</span><span class="p">)</span> <span class="nf">getColumnName</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">maxColumnRowNameLen</span> <span class="kt">int</span><span class="p">)</span> <span class="p">[]</span><span class="kt">byte</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">const</span> <span class="nx">A</span> <span class="p">=</span> <span class="sc">&#39;A&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">column</span> <span class="p">&lt;</span> <span class="nx">maxCharCount</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 第一次就分配好切片的容量</span>
</span></span><span class="line"><span class="cl">        <span class="nx">slice</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">maxColumnRowNameLen</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">append</span><span class="p">(</span><span class="nx">slice</span><span class="p">,</span> <span class="nb">byte</span><span class="p">(</span><span class="nx">A</span><span class="o">+</span><span class="nx">column</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 递归生成类似AA,AB,AAA,AAB这种形式的列名</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">append</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nf">getColumnName</span><span class="p">(</span><span class="nx">column</span><span class="o">/</span><span class="nx">maxCharCount</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">maxColumnRowNameLen</span><span class="p">),</span> <span class="nb">byte</span><span class="p">(</span><span class="nx">A</span><span class="o">+</span><span class="nx">column</span><span class="o">%</span><span class="nx">maxCharCount</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// getColumnRowName 生成名称框</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Excel的名称框是用A1,A2,B1,B2来表示的，这里需要传入前一步生成的列名切片，然后直接加上行索引来生成名称框，就无需每次分配内存</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">Excel</span><span class="p">)</span> <span class="nf">getColumnRowName</span><span class="p">(</span><span class="nx">columnName</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">rowIndex</span> <span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="nx">columnRowName</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">l</span> <span class="o">:=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">columnName</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">columnName</span> <span class="p">=</span> <span class="nx">strconv</span><span class="p">.</span><span class="nf">AppendInt</span><span class="p">(</span><span class="nx">columnName</span><span class="p">,</span> <span class="nb">int64</span><span class="p">(</span><span class="nx">rowIndex</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">columnRowName</span> <span class="p">=</span> <span class="nb">string</span><span class="p">(</span><span class="nx">columnName</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 将列名恢复回去</span>
</span></span><span class="line"><span class="cl">    <span class="nx">columnName</span> <span class="p">=</span> <span class="nx">columnName</span><span class="p">[:</span><span class="nx">l</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="web端调用示例">WEB端调用示例</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">controller</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;bytes&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;github.com/labstack/echo/v4&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;xxx/lib/tool&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;net/http&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">xxxController</span> <span class="kd">struct</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">XxxController</span> <span class="p">=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">xxxController</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Router</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/export&#34;</span><span class="p">,</span> <span class="nx">AuthCorpController</span><span class="p">.</span><span class="nx">Export</span><span class="p">).</span><span class="nx">Name</span> <span class="p">=</span> <span class="s">&#34;导出excel&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">xxxController</span><span class="p">)</span> <span class="nf">Export</span><span class="p">(</span><span class="nx">c</span> <span class="nx">echo</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="nx">excelHeaders</span> <span class="p">=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;姓名&#34;</span><span class="p">,</span> <span class="s">&#34;性别&#34;</span><span class="p">,</span> <span class="s">&#34;年龄&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">excelRows</span>    <span class="p">=</span> <span class="p">[][]</span><span class="kd">interface</span><span class="p">{}{</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span><span class="s">&#34;张三&#34;</span><span class="p">,</span> <span class="s">&#34;女&#34;</span><span class="p">,</span> <span class="mi">18</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span><span class="s">&#34;李四&#34;</span><span class="p">,</span> <span class="s">&#34;男&#34;</span><span class="p">,</span> <span class="mi">19</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">b</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">tool</span><span class="p">.</span><span class="nx">Excel</span><span class="p">{</span><span class="nx">Headers</span><span class="p">:</span> <span class="nx">excelHeaders</span><span class="p">,</span> <span class="nx">Rows</span><span class="p">:</span> <span class="nx">excelRows</span><span class="p">}.</span><span class="nf">ExportToWeb</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nx">c</span><span class="p">.</span><span class="nf">Response</span><span class="p">().</span><span class="nf">Header</span><span class="p">().</span><span class="nf">Set</span><span class="p">(</span><span class="nx">echo</span><span class="p">.</span><span class="nx">HeaderContentDisposition</span><span class="p">,</span> <span class="s">&#34;attachment; filename=students.xlsx&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Stream</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">echo</span><span class="p">.</span><span class="nx">MIMEOctetStream</span><span class="p">,</span> <span class="nx">bytes</span><span class="p">.</span><span class="nf">NewReader</span><span class="p">(</span><span class="nx">b</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="csv导入">csv导入</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">tool</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;bufio&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;bytes&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;encoding/csv&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;errors&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;golang.org/x/text/encoding/simplifiedchinese&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;golang.org/x/text/transform&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;io&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;mime/multipart&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;strconv&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;strings&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Csv</span> <span class="kd">struct</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 从文件流读取 csv 的所有数据</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="nx">Csv</span><span class="p">)</span> <span class="nf">ReadCsvFromStream</span><span class="p">(</span><span class="nx">f</span> <span class="o">*</span><span class="nx">multipart</span><span class="p">.</span><span class="nx">FileHeader</span><span class="p">)</span> <span class="p">([][]</span><span class="kt">string</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">rows</span> <span class="p">[][]</span><span class="kt">string</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">src</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">f</span><span class="p">.</span><span class="nf">Open</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">rows</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">defer</span> <span class="nx">src</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 兆字节转为字节进行比较大小</span>
</span></span><span class="line"><span class="cl">    <span class="nx">maxFileSize</span> <span class="o">:=</span> <span class="nb">int64</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1">// 默认最大上传 2 M</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">f</span><span class="p">.</span><span class="nx">Size</span> <span class="p">&gt;</span> <span class="nx">maxFileSize</span><span class="o">*</span><span class="mf">1e6</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">rows</span><span class="p">,</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;文件大小不能超过 &#34;</span> <span class="o">+</span> <span class="nx">strconv</span><span class="p">.</span><span class="nf">FormatInt</span><span class="p">(</span><span class="nx">maxFileSize</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#34; M&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 初始化一个 csv reader，并通过这个 reader 从 csv 文件读取数据</span>
</span></span><span class="line"><span class="cl">    <span class="nx">reader</span> <span class="o">:=</span> <span class="nx">csv</span><span class="p">.</span><span class="nf">NewReader</span><span class="p">(</span><span class="nx">transform</span><span class="p">.</span><span class="nf">NewReader</span><span class="p">(</span><span class="nx">bufio</span><span class="p">.</span><span class="nf">NewReader</span><span class="p">(</span><span class="nx">src</span><span class="p">),</span> <span class="nx">simplifiedchinese</span><span class="p">.</span><span class="nx">GBK</span><span class="p">.</span><span class="nf">NewDecoder</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 设置返回记录中每行数据期望的字段数，-1 表示返回所有字段</span>
</span></span><span class="line"><span class="cl">    <span class="nx">reader</span><span class="p">.</span><span class="nx">FieldsPerRecord</span> <span class="p">=</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 通过 readAll 方法返回 csv 文件中的所有内容</span>
</span></span><span class="line"><span class="cl">    <span class="nx">rows</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">reader</span><span class="p">.</span><span class="nf">ReadAll</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">rows</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">rows</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 从文件流读取不规范 csv 的所有数据</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="nx">Csv</span><span class="p">)</span> <span class="nf">ReadIllegalCsvFromSteam</span><span class="p">(</span><span class="nx">f</span> <span class="o">*</span><span class="nx">multipart</span><span class="p">.</span><span class="nx">FileHeader</span><span class="p">)</span> <span class="p">([][]</span><span class="kt">string</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">rows</span> <span class="p">[][]</span><span class="kt">string</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">src</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">f</span><span class="p">.</span><span class="nf">Open</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">rows</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">defer</span> <span class="nx">src</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 兆字节转为字节进行比较大小</span>
</span></span><span class="line"><span class="cl">    <span class="nx">maxFileSize</span> <span class="o">:=</span> <span class="nb">int64</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1">// 默认最大上传 2 M</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">f</span><span class="p">.</span><span class="nx">Size</span> <span class="p">&gt;</span> <span class="nx">maxFileSize</span><span class="o">*</span><span class="mf">1e6</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">rows</span><span class="p">,</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;文件大小不能超过 &#34;</span> <span class="o">+</span> <span class="nx">strconv</span><span class="p">.</span><span class="nf">FormatInt</span><span class="p">(</span><span class="nx">maxFileSize</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#34; M&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 直接复制文件内容</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">buf</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">io</span><span class="p">.</span><span class="nf">Copy</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">buf</span><span class="p">,</span> <span class="nx">transform</span><span class="p">.</span><span class="nf">NewReader</span><span class="p">(</span><span class="nx">bufio</span><span class="p">.</span><span class="nf">NewReader</span><span class="p">(</span><span class="nx">src</span><span class="p">),</span> <span class="nx">simplifiedchinese</span><span class="p">.</span><span class="nx">GBK</span><span class="p">.</span><span class="nf">NewDecoder</span><span class="p">()));</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">rows</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">contents</span> <span class="o">:=</span> <span class="nx">buf</span><span class="p">.</span><span class="nf">String</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nx">slice</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="nx">contents</span><span class="p">,</span> <span class="s">&#34;\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">slice</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">records</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nf">ReplaceAll</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="s">&#34;=\&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;\&#34;&#34;</span><span class="p">),</span> <span class="s">&#34;,&#34;</span><span class="p">)</span> <span class="c1">// 去掉不合法的等号</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="nx">kk</span><span class="p">,</span> <span class="nx">vv</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">records</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">records</span><span class="p">[</span><span class="nx">kk</span><span class="p">]</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Trim</span><span class="p">(</span><span class="nx">vv</span><span class="p">,</span> <span class="s">&#34;\&#34;&#34;</span><span class="p">)</span> <span class="c1">// 去除前后的双引号</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">rows</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">rows</span><span class="p">,</span> <span class="nx">records</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">rows</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content"></span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2022-03-16
        
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/excel/">excel</a>
          <a href="/tags/excelize/">excelize</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/golang/go%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Go 性能分析工具</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/%E7%BA%BF%E4%B8%8A%E4%BA%8B%E6%95%85%E8%AE%B0%E5%BD%95/">
            <span class="next-text nav-default">线上事故记录</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js" crossorigin="anonymous"></script>
    <script type="text/javascript">
      var gitalk = new Gitalk({
        id: '2022-03-16 15:41:12 \u002b0800 CST',
        title: '简单的excel导入导出',
        clientID: 'fe63c88fe7fc18e38512',
        clientSecret: 'e44ced40487d261a6006f9af23a2f788bf1e0a85',
        repo: 'zsmhub.github.io',
        owner: 'zsmhub',
        admin: ['zsmhub'],
        body: decodeURI(location.href)
      });
      gitalk.render('gitalk-container');
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/gitalk/gitalk">comments powered by gitalk.</a></noscript>

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:zhangshimiande@email.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/zsmhub" class="iconfont icon-github" title="github"></a>
  
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2019 - 
    2026<span class="heart"><i class="iconfont icon-heart"></i></span><span>ZsmHub</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
