<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>图片水印 - ZsmHub - Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="" /><meta name="description" content="图片平铺水印 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 package main import ( &#34;flag&#34; &#34;fmt&#34; &#34;image&#34; &#34;image/draw&#34; &#34;image/jpeg&#34; &#34;image/png&#34; &#34;log&#34; &#34;math&#34; &#34;os&#34; &#34;path/filepath&#34; &#34;strings&#34; ) // 配置参数 type Config struct { SourcePath string // 原图路径 WatermarkPath string // 水印图路径 OutputPath string // 输出图片路径 WatermarkScale float64 // 水印缩放比例 (0.1-1.0) WatermarkDensity int // 水印密集程度 (间隔像素) } // 加载图片 func loadImage(filePath string) (image.Image, error) { file, err := os.Open(filePath) if err != nil { return nil, err } defer file.Close() // 优先自动识别图片格式 img, _, err := image.Decode(file) if err == nil { return img, nil } // fallback: 用后缀判断 ext := strings.ToLower(filepath.Ext(filePath)) _, _ = file.Seek(0, 0) // 重置文件指针 switch ext { case &#34;.jpg&#34;, &#34;.jpeg&#34;: img, err = jpeg.Decode(file) case &#34;.png&#34;: img, err = png.Decode(file) default: return nil, fmt.Errorf(&#34;不支持的图片格式: %s&#34;, ext) } return img, err } // 保存图片 func saveImage(img image.Image, outputPath string) error { file, err := os.Create(outputPath) if err != nil { return err } defer file.Close() ext := strings.ToLower(filepath.Ext(outputPath)) switch ext { case &#34;.jpg&#34;, &#34;.jpeg&#34;: err = jpeg.Encode(file, img, &amp;jpeg.Options{Quality: 90}) case &#34;.png&#34;: err = png.Encode(file, img) default: return fmt.Errorf(&#34;不支持的输出格式: %s&#34;, ext) } return err } // 调整水印图片大小 func resizeWatermark(watermark image.Image, scale float64) image.Image { bounds := watermark.Bounds() width := int(float64(bounds.Dx()) * scale) height := int(float64(bounds.Dy()) * scale) // 确保宽高至少为1像素 if width &lt; 1 { width = 1 } if height &lt; 1 { height = 1 } resized := image.NewRGBA(image.Rect(0, 0, width, height)) // 简单的缩放算法 for y := 0; y &lt; height; y&#43;&#43; { for x := 0; x &lt; width; x&#43;&#43; { srcX := x * bounds.Dx() / width srcY := y * bounds.Dy() / height resized.Set(x, y, watermark.At(srcX, srcY)) } } return resized } // 添加平铺水印 func addTiledWatermark(src image.Image, watermark image.Image, density int) image.Image { srcBounds := src.Bounds() watermarkBounds := watermark.Bounds() // 创建输出图像 result := image.NewRGBA(srcBounds) draw.Draw(result, srcBounds, src, image.Point{}, draw.Src) // 计算水印平铺的行列数 cols := int(math.Ceil(float64(srcBounds.Dx()) / float64(watermarkBounds.Dx()&#43;density))) rows := int(math.Ceil(float64(srcBounds.Dy()) / float64(watermarkBounds.Dy()&#43;density))) // 平铺水印 for row := 0; row &lt; rows; row&#43;&#43; { for col := 0; col &lt; cols; col&#43;&#43; { x := col * (watermarkBounds.Dx() &#43; density) y := row * (watermarkBounds.Dy() &#43; density) // 水印位置 watermarkPos := image.Rect( x, y, x&#43;watermarkBounds.Dx(), y&#43;watermarkBounds.Dy(), ) // 确保水印不超出原图范围 if watermarkPos.Max.X &gt; srcBounds.Max.X || watermarkPos.Max.Y &gt; srcBounds.Max.Y { watermarkPos = watermarkPos.Intersect(srcBounds) } // 绘制水印 draw.Draw(result, watermarkPos, watermark, image.Point{}, draw.Over) } } return result } func main() { // 解析命令行参数 config := Config{ SourcePath: &#34;/Users/xxx/Downloads/yuantu.jpg&#34;, WatermarkPath: &#34;/Users/xxx/Downloads/shuiyin.png&#34;, OutputPath: &#34;/Users/xxx/Downloads/output.png&#34;, WatermarkScale: 0.8, WatermarkDensity: 50, } // flag.StringVar(&amp;config.SourcePath, &#34;src&#34;, &#34;&#34;, &#34;原图路径 (必填)&#34;) // flag.StringVar(&amp;config.WatermarkPath, &#34;watermark&#34;, &#34;&#34;, &#34;水印图路径 (必填)&#34;) // flag.StringVar(&amp;config.OutputPath, &#34;output&#34;, &#34;output.jpg&#34;, &#34;输出图片路径&#34;) // flag.Float64Var(&amp;config.WatermarkScale, &#34;scale&#34;, 0.3, &#34;水印缩放比例 (0.1-1.0)&#34;) // flag.IntVar(&amp;config.WatermarkDensity, &#34;density&#34;, 50, &#34;水印密集程度 (间隔像素)&#34;) flag.Parse() // 验证必填参数 if config.SourcePath == &#34;&#34; || config.WatermarkPath == &#34;&#34; { fmt.Println(&#34;使用方法:&#34;) fmt.Println(&#34; watermark -src &lt;原图路径&gt; -watermark &lt;水印图路径&gt; [选项]&#34;) fmt.Println(&#34;\n选项:&#34;) flag.PrintDefaults() os.Exit(1) } // 验证缩放比例范围 if config.WatermarkScale &lt; 0.1 || config.WatermarkScale &gt; 1.0 { log.Fatal(&#34;水印缩放比例必须在 0.1 到 1.0 之间&#34;) } // 验证密集程度范围 if config.WatermarkDensity &lt; 0 { log.Fatal(&#34;水印密集程度必须大于等于 0&#34;) } // 加载原图 srcImg, err := loadImage(config.SourcePath) if err != nil { log.Fatalf(&#34;加载原图失败: %v&#34;, err) } // 加载水印图 watermarkImg, err := loadImage(config.WatermarkPath) if err != nil { log.Fatalf(&#34;加载水印图失败: %v&#34;, err) } // 调整水印大小 resizedWatermark := resizeWatermark(watermarkImg, config.WatermarkScale) // 添加平铺水印 resultImg := addTiledWatermark(srcImg, resizedWatermark, config.WatermarkDensity) // 保存结果 if err := saveImage(resultImg, config.OutputPath); err != nil { log.Fatalf(&#34;保存图片失败: %v&#34;, err) } fmt.Printf(&#34;水印添加成功，已保存到: %s\n&#34;, config.OutputPath) } " /><meta name="keywords" content="Hugo, even, zsmhub, blog, php, golang" />






<meta name="generator" content="Hugo 0.146.4 with theme even" />


<link rel="canonical" href="https://zsmhub.github.io/post/golang/%E5%9B%BE%E7%89%87%E6%B0%B4%E5%8D%B0/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:url" content="https://zsmhub.github.io/post/golang/%E5%9B%BE%E7%89%87%E6%B0%B4%E5%8D%B0/">
  <meta property="og:site_name" content="ZsmHub - Blog">
  <meta property="og:title" content="图片水印">
  <meta property="og:description" content="图片平铺水印 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 package main import ( &#34;flag&#34; &#34;fmt&#34; &#34;image&#34; &#34;image/draw&#34; &#34;image/jpeg&#34; &#34;image/png&#34; &#34;log&#34; &#34;math&#34; &#34;os&#34; &#34;path/filepath&#34; &#34;strings&#34; ) // 配置参数 type Config struct { SourcePath string // 原图路径 WatermarkPath string // 水印图路径 OutputPath string // 输出图片路径 WatermarkScale float64 // 水印缩放比例 (0.1-1.0) WatermarkDensity int // 水印密集程度 (间隔像素) } // 加载图片 func loadImage(filePath string) (image.Image, error) { file, err := os.Open(filePath) if err != nil { return nil, err } defer file.Close() // 优先自动识别图片格式 img, _, err := image.Decode(file) if err == nil { return img, nil } // fallback: 用后缀判断 ext := strings.ToLower(filepath.Ext(filePath)) _, _ = file.Seek(0, 0) // 重置文件指针 switch ext { case &#34;.jpg&#34;, &#34;.jpeg&#34;: img, err = jpeg.Decode(file) case &#34;.png&#34;: img, err = png.Decode(file) default: return nil, fmt.Errorf(&#34;不支持的图片格式: %s&#34;, ext) } return img, err } // 保存图片 func saveImage(img image.Image, outputPath string) error { file, err := os.Create(outputPath) if err != nil { return err } defer file.Close() ext := strings.ToLower(filepath.Ext(outputPath)) switch ext { case &#34;.jpg&#34;, &#34;.jpeg&#34;: err = jpeg.Encode(file, img, &amp;jpeg.Options{Quality: 90}) case &#34;.png&#34;: err = png.Encode(file, img) default: return fmt.Errorf(&#34;不支持的输出格式: %s&#34;, ext) } return err } // 调整水印图片大小 func resizeWatermark(watermark image.Image, scale float64) image.Image { bounds := watermark.Bounds() width := int(float64(bounds.Dx()) * scale) height := int(float64(bounds.Dy()) * scale) // 确保宽高至少为1像素 if width &lt; 1 { width = 1 } if height &lt; 1 { height = 1 } resized := image.NewRGBA(image.Rect(0, 0, width, height)) // 简单的缩放算法 for y := 0; y &lt; height; y&#43;&#43; { for x := 0; x &lt; width; x&#43;&#43; { srcX := x * bounds.Dx() / width srcY := y * bounds.Dy() / height resized.Set(x, y, watermark.At(srcX, srcY)) } } return resized } // 添加平铺水印 func addTiledWatermark(src image.Image, watermark image.Image, density int) image.Image { srcBounds := src.Bounds() watermarkBounds := watermark.Bounds() // 创建输出图像 result := image.NewRGBA(srcBounds) draw.Draw(result, srcBounds, src, image.Point{}, draw.Src) // 计算水印平铺的行列数 cols := int(math.Ceil(float64(srcBounds.Dx()) / float64(watermarkBounds.Dx()&#43;density))) rows := int(math.Ceil(float64(srcBounds.Dy()) / float64(watermarkBounds.Dy()&#43;density))) // 平铺水印 for row := 0; row &lt; rows; row&#43;&#43; { for col := 0; col &lt; cols; col&#43;&#43; { x := col * (watermarkBounds.Dx() &#43; density) y := row * (watermarkBounds.Dy() &#43; density) // 水印位置 watermarkPos := image.Rect( x, y, x&#43;watermarkBounds.Dx(), y&#43;watermarkBounds.Dy(), ) // 确保水印不超出原图范围 if watermarkPos.Max.X &gt; srcBounds.Max.X || watermarkPos.Max.Y &gt; srcBounds.Max.Y { watermarkPos = watermarkPos.Intersect(srcBounds) } // 绘制水印 draw.Draw(result, watermarkPos, watermark, image.Point{}, draw.Over) } } return result } func main() { // 解析命令行参数 config := Config{ SourcePath: &#34;/Users/xxx/Downloads/yuantu.jpg&#34;, WatermarkPath: &#34;/Users/xxx/Downloads/shuiyin.png&#34;, OutputPath: &#34;/Users/xxx/Downloads/output.png&#34;, WatermarkScale: 0.8, WatermarkDensity: 50, } // flag.StringVar(&amp;config.SourcePath, &#34;src&#34;, &#34;&#34;, &#34;原图路径 (必填)&#34;) // flag.StringVar(&amp;config.WatermarkPath, &#34;watermark&#34;, &#34;&#34;, &#34;水印图路径 (必填)&#34;) // flag.StringVar(&amp;config.OutputPath, &#34;output&#34;, &#34;output.jpg&#34;, &#34;输出图片路径&#34;) // flag.Float64Var(&amp;config.WatermarkScale, &#34;scale&#34;, 0.3, &#34;水印缩放比例 (0.1-1.0)&#34;) // flag.IntVar(&amp;config.WatermarkDensity, &#34;density&#34;, 50, &#34;水印密集程度 (间隔像素)&#34;) flag.Parse() // 验证必填参数 if config.SourcePath == &#34;&#34; || config.WatermarkPath == &#34;&#34; { fmt.Println(&#34;使用方法:&#34;) fmt.Println(&#34; watermark -src &lt;原图路径&gt; -watermark &lt;水印图路径&gt; [选项]&#34;) fmt.Println(&#34;\n选项:&#34;) flag.PrintDefaults() os.Exit(1) } // 验证缩放比例范围 if config.WatermarkScale &lt; 0.1 || config.WatermarkScale &gt; 1.0 { log.Fatal(&#34;水印缩放比例必须在 0.1 到 1.0 之间&#34;) } // 验证密集程度范围 if config.WatermarkDensity &lt; 0 { log.Fatal(&#34;水印密集程度必须大于等于 0&#34;) } // 加载原图 srcImg, err := loadImage(config.SourcePath) if err != nil { log.Fatalf(&#34;加载原图失败: %v&#34;, err) } // 加载水印图 watermarkImg, err := loadImage(config.WatermarkPath) if err != nil { log.Fatalf(&#34;加载水印图失败: %v&#34;, err) } // 调整水印大小 resizedWatermark := resizeWatermark(watermarkImg, config.WatermarkScale) // 添加平铺水印 resultImg := addTiledWatermark(srcImg, resizedWatermark, config.WatermarkDensity) // 保存结果 if err := saveImage(resultImg, config.OutputPath); err != nil { log.Fatalf(&#34;保存图片失败: %v&#34;, err) } fmt.Printf(&#34;水印添加成功，已保存到: %s\n&#34;, config.OutputPath) }">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2025-05-21T10:35:55+08:00">
    <meta property="article:modified_time" content="2025-05-21T10:35:55+08:00">
    <meta property="article:tag" content="水印">

  <meta itemprop="name" content="图片水印">
  <meta itemprop="description" content="图片平铺水印 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 package main import ( &#34;flag&#34; &#34;fmt&#34; &#34;image&#34; &#34;image/draw&#34; &#34;image/jpeg&#34; &#34;image/png&#34; &#34;log&#34; &#34;math&#34; &#34;os&#34; &#34;path/filepath&#34; &#34;strings&#34; ) // 配置参数 type Config struct { SourcePath string // 原图路径 WatermarkPath string // 水印图路径 OutputPath string // 输出图片路径 WatermarkScale float64 // 水印缩放比例 (0.1-1.0) WatermarkDensity int // 水印密集程度 (间隔像素) } // 加载图片 func loadImage(filePath string) (image.Image, error) { file, err := os.Open(filePath) if err != nil { return nil, err } defer file.Close() // 优先自动识别图片格式 img, _, err := image.Decode(file) if err == nil { return img, nil } // fallback: 用后缀判断 ext := strings.ToLower(filepath.Ext(filePath)) _, _ = file.Seek(0, 0) // 重置文件指针 switch ext { case &#34;.jpg&#34;, &#34;.jpeg&#34;: img, err = jpeg.Decode(file) case &#34;.png&#34;: img, err = png.Decode(file) default: return nil, fmt.Errorf(&#34;不支持的图片格式: %s&#34;, ext) } return img, err } // 保存图片 func saveImage(img image.Image, outputPath string) error { file, err := os.Create(outputPath) if err != nil { return err } defer file.Close() ext := strings.ToLower(filepath.Ext(outputPath)) switch ext { case &#34;.jpg&#34;, &#34;.jpeg&#34;: err = jpeg.Encode(file, img, &amp;jpeg.Options{Quality: 90}) case &#34;.png&#34;: err = png.Encode(file, img) default: return fmt.Errorf(&#34;不支持的输出格式: %s&#34;, ext) } return err } // 调整水印图片大小 func resizeWatermark(watermark image.Image, scale float64) image.Image { bounds := watermark.Bounds() width := int(float64(bounds.Dx()) * scale) height := int(float64(bounds.Dy()) * scale) // 确保宽高至少为1像素 if width &lt; 1 { width = 1 } if height &lt; 1 { height = 1 } resized := image.NewRGBA(image.Rect(0, 0, width, height)) // 简单的缩放算法 for y := 0; y &lt; height; y&#43;&#43; { for x := 0; x &lt; width; x&#43;&#43; { srcX := x * bounds.Dx() / width srcY := y * bounds.Dy() / height resized.Set(x, y, watermark.At(srcX, srcY)) } } return resized } // 添加平铺水印 func addTiledWatermark(src image.Image, watermark image.Image, density int) image.Image { srcBounds := src.Bounds() watermarkBounds := watermark.Bounds() // 创建输出图像 result := image.NewRGBA(srcBounds) draw.Draw(result, srcBounds, src, image.Point{}, draw.Src) // 计算水印平铺的行列数 cols := int(math.Ceil(float64(srcBounds.Dx()) / float64(watermarkBounds.Dx()&#43;density))) rows := int(math.Ceil(float64(srcBounds.Dy()) / float64(watermarkBounds.Dy()&#43;density))) // 平铺水印 for row := 0; row &lt; rows; row&#43;&#43; { for col := 0; col &lt; cols; col&#43;&#43; { x := col * (watermarkBounds.Dx() &#43; density) y := row * (watermarkBounds.Dy() &#43; density) // 水印位置 watermarkPos := image.Rect( x, y, x&#43;watermarkBounds.Dx(), y&#43;watermarkBounds.Dy(), ) // 确保水印不超出原图范围 if watermarkPos.Max.X &gt; srcBounds.Max.X || watermarkPos.Max.Y &gt; srcBounds.Max.Y { watermarkPos = watermarkPos.Intersect(srcBounds) } // 绘制水印 draw.Draw(result, watermarkPos, watermark, image.Point{}, draw.Over) } } return result } func main() { // 解析命令行参数 config := Config{ SourcePath: &#34;/Users/xxx/Downloads/yuantu.jpg&#34;, WatermarkPath: &#34;/Users/xxx/Downloads/shuiyin.png&#34;, OutputPath: &#34;/Users/xxx/Downloads/output.png&#34;, WatermarkScale: 0.8, WatermarkDensity: 50, } // flag.StringVar(&amp;config.SourcePath, &#34;src&#34;, &#34;&#34;, &#34;原图路径 (必填)&#34;) // flag.StringVar(&amp;config.WatermarkPath, &#34;watermark&#34;, &#34;&#34;, &#34;水印图路径 (必填)&#34;) // flag.StringVar(&amp;config.OutputPath, &#34;output&#34;, &#34;output.jpg&#34;, &#34;输出图片路径&#34;) // flag.Float64Var(&amp;config.WatermarkScale, &#34;scale&#34;, 0.3, &#34;水印缩放比例 (0.1-1.0)&#34;) // flag.IntVar(&amp;config.WatermarkDensity, &#34;density&#34;, 50, &#34;水印密集程度 (间隔像素)&#34;) flag.Parse() // 验证必填参数 if config.SourcePath == &#34;&#34; || config.WatermarkPath == &#34;&#34; { fmt.Println(&#34;使用方法:&#34;) fmt.Println(&#34; watermark -src &lt;原图路径&gt; -watermark &lt;水印图路径&gt; [选项]&#34;) fmt.Println(&#34;\n选项:&#34;) flag.PrintDefaults() os.Exit(1) } // 验证缩放比例范围 if config.WatermarkScale &lt; 0.1 || config.WatermarkScale &gt; 1.0 { log.Fatal(&#34;水印缩放比例必须在 0.1 到 1.0 之间&#34;) } // 验证密集程度范围 if config.WatermarkDensity &lt; 0 { log.Fatal(&#34;水印密集程度必须大于等于 0&#34;) } // 加载原图 srcImg, err := loadImage(config.SourcePath) if err != nil { log.Fatalf(&#34;加载原图失败: %v&#34;, err) } // 加载水印图 watermarkImg, err := loadImage(config.WatermarkPath) if err != nil { log.Fatalf(&#34;加载水印图失败: %v&#34;, err) } // 调整水印大小 resizedWatermark := resizeWatermark(watermarkImg, config.WatermarkScale) // 添加平铺水印 resultImg := addTiledWatermark(srcImg, resizedWatermark, config.WatermarkDensity) // 保存结果 if err := saveImage(resultImg, config.OutputPath); err != nil { log.Fatalf(&#34;保存图片失败: %v&#34;, err) } fmt.Printf(&#34;水印添加成功，已保存到: %s\n&#34;, config.OutputPath) }">
  <meta itemprop="datePublished" content="2025-05-21T10:35:55+08:00">
  <meta itemprop="dateModified" content="2025-05-21T10:35:55+08:00">
  <meta itemprop="wordCount" content="1275">
  <meta itemprop="keywords" content="水印">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="图片水印">
  <meta name="twitter:description" content="图片平铺水印 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 package main import ( &#34;flag&#34; &#34;fmt&#34; &#34;image&#34; &#34;image/draw&#34; &#34;image/jpeg&#34; &#34;image/png&#34; &#34;log&#34; &#34;math&#34; &#34;os&#34; &#34;path/filepath&#34; &#34;strings&#34; ) // 配置参数 type Config struct { SourcePath string // 原图路径 WatermarkPath string // 水印图路径 OutputPath string // 输出图片路径 WatermarkScale float64 // 水印缩放比例 (0.1-1.0) WatermarkDensity int // 水印密集程度 (间隔像素) } // 加载图片 func loadImage(filePath string) (image.Image, error) { file, err := os.Open(filePath) if err != nil { return nil, err } defer file.Close() // 优先自动识别图片格式 img, _, err := image.Decode(file) if err == nil { return img, nil } // fallback: 用后缀判断 ext := strings.ToLower(filepath.Ext(filePath)) _, _ = file.Seek(0, 0) // 重置文件指针 switch ext { case &#34;.jpg&#34;, &#34;.jpeg&#34;: img, err = jpeg.Decode(file) case &#34;.png&#34;: img, err = png.Decode(file) default: return nil, fmt.Errorf(&#34;不支持的图片格式: %s&#34;, ext) } return img, err } // 保存图片 func saveImage(img image.Image, outputPath string) error { file, err := os.Create(outputPath) if err != nil { return err } defer file.Close() ext := strings.ToLower(filepath.Ext(outputPath)) switch ext { case &#34;.jpg&#34;, &#34;.jpeg&#34;: err = jpeg.Encode(file, img, &amp;jpeg.Options{Quality: 90}) case &#34;.png&#34;: err = png.Encode(file, img) default: return fmt.Errorf(&#34;不支持的输出格式: %s&#34;, ext) } return err } // 调整水印图片大小 func resizeWatermark(watermark image.Image, scale float64) image.Image { bounds := watermark.Bounds() width := int(float64(bounds.Dx()) * scale) height := int(float64(bounds.Dy()) * scale) // 确保宽高至少为1像素 if width &lt; 1 { width = 1 } if height &lt; 1 { height = 1 } resized := image.NewRGBA(image.Rect(0, 0, width, height)) // 简单的缩放算法 for y := 0; y &lt; height; y&#43;&#43; { for x := 0; x &lt; width; x&#43;&#43; { srcX := x * bounds.Dx() / width srcY := y * bounds.Dy() / height resized.Set(x, y, watermark.At(srcX, srcY)) } } return resized } // 添加平铺水印 func addTiledWatermark(src image.Image, watermark image.Image, density int) image.Image { srcBounds := src.Bounds() watermarkBounds := watermark.Bounds() // 创建输出图像 result := image.NewRGBA(srcBounds) draw.Draw(result, srcBounds, src, image.Point{}, draw.Src) // 计算水印平铺的行列数 cols := int(math.Ceil(float64(srcBounds.Dx()) / float64(watermarkBounds.Dx()&#43;density))) rows := int(math.Ceil(float64(srcBounds.Dy()) / float64(watermarkBounds.Dy()&#43;density))) // 平铺水印 for row := 0; row &lt; rows; row&#43;&#43; { for col := 0; col &lt; cols; col&#43;&#43; { x := col * (watermarkBounds.Dx() &#43; density) y := row * (watermarkBounds.Dy() &#43; density) // 水印位置 watermarkPos := image.Rect( x, y, x&#43;watermarkBounds.Dx(), y&#43;watermarkBounds.Dy(), ) // 确保水印不超出原图范围 if watermarkPos.Max.X &gt; srcBounds.Max.X || watermarkPos.Max.Y &gt; srcBounds.Max.Y { watermarkPos = watermarkPos.Intersect(srcBounds) } // 绘制水印 draw.Draw(result, watermarkPos, watermark, image.Point{}, draw.Over) } } return result } func main() { // 解析命令行参数 config := Config{ SourcePath: &#34;/Users/xxx/Downloads/yuantu.jpg&#34;, WatermarkPath: &#34;/Users/xxx/Downloads/shuiyin.png&#34;, OutputPath: &#34;/Users/xxx/Downloads/output.png&#34;, WatermarkScale: 0.8, WatermarkDensity: 50, } // flag.StringVar(&amp;config.SourcePath, &#34;src&#34;, &#34;&#34;, &#34;原图路径 (必填)&#34;) // flag.StringVar(&amp;config.WatermarkPath, &#34;watermark&#34;, &#34;&#34;, &#34;水印图路径 (必填)&#34;) // flag.StringVar(&amp;config.OutputPath, &#34;output&#34;, &#34;output.jpg&#34;, &#34;输出图片路径&#34;) // flag.Float64Var(&amp;config.WatermarkScale, &#34;scale&#34;, 0.3, &#34;水印缩放比例 (0.1-1.0)&#34;) // flag.IntVar(&amp;config.WatermarkDensity, &#34;density&#34;, 50, &#34;水印密集程度 (间隔像素)&#34;) flag.Parse() // 验证必填参数 if config.SourcePath == &#34;&#34; || config.WatermarkPath == &#34;&#34; { fmt.Println(&#34;使用方法:&#34;) fmt.Println(&#34; watermark -src &lt;原图路径&gt; -watermark &lt;水印图路径&gt; [选项]&#34;) fmt.Println(&#34;\n选项:&#34;) flag.PrintDefaults() os.Exit(1) } // 验证缩放比例范围 if config.WatermarkScale &lt; 0.1 || config.WatermarkScale &gt; 1.0 { log.Fatal(&#34;水印缩放比例必须在 0.1 到 1.0 之间&#34;) } // 验证密集程度范围 if config.WatermarkDensity &lt; 0 { log.Fatal(&#34;水印密集程度必须大于等于 0&#34;) } // 加载原图 srcImg, err := loadImage(config.SourcePath) if err != nil { log.Fatalf(&#34;加载原图失败: %v&#34;, err) } // 加载水印图 watermarkImg, err := loadImage(config.WatermarkPath) if err != nil { log.Fatalf(&#34;加载水印图失败: %v&#34;, err) } // 调整水印大小 resizedWatermark := resizeWatermark(watermarkImg, config.WatermarkScale) // 添加平铺水印 resultImg := addTiledWatermark(srcImg, resizedWatermark, config.WatermarkDensity) // 保存结果 if err := saveImage(resultImg, config.OutputPath); err != nil { log.Fatalf(&#34;保存图片失败: %v&#34;, err) } fmt.Printf(&#34;水印添加成功，已保存到: %s\n&#34;, config.OutputPath) }">

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">ZsmHub Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">首页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">分类</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="/navigation">
        <li class="mobile-menu-item">导航</li>
      </a><a href="/about">
        <li class="mobile-menu-item">关于</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">ZsmHub Blog</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">首页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">分类</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/navigation">导航</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about">关于</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">图片水印</h1>

      <div class="post-meta">
        <span class="post-time"> 2025-05-21 </span>
        <div class="post-category">
            <a href="/categories/golang/"> golang </a>
            </div>
          <span class="more-meta"> 约 1275 字 </span>
          <span class="more-meta"> 预计阅读 3 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#图片平铺水印">图片平铺水印</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="图片平铺水印">图片平铺水印</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;flag&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;image&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;image/draw&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;image/jpeg&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;image/png&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;log&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;math&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;os&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;path/filepath&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;strings&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 配置参数</span>
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Config</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">SourcePath</span>       <span class="kt">string</span>  <span class="c1">// 原图路径</span>
</span></span><span class="line"><span class="cl">    <span class="nx">WatermarkPath</span>    <span class="kt">string</span>  <span class="c1">// 水印图路径</span>
</span></span><span class="line"><span class="cl">    <span class="nx">OutputPath</span>       <span class="kt">string</span>  <span class="c1">// 输出图片路径</span>
</span></span><span class="line"><span class="cl">    <span class="nx">WatermarkScale</span>   <span class="kt">float64</span> <span class="c1">// 水印缩放比例 (0.1-1.0)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">WatermarkDensity</span> <span class="kt">int</span>     <span class="c1">// 水印密集程度 (间隔像素)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 加载图片</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">loadImage</span><span class="p">(</span><span class="nx">filePath</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">image</span><span class="p">.</span><span class="nx">Image</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Open</span><span class="p">(</span><span class="nx">filePath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">     <span class="p">}</span>
</span></span><span class="line"><span class="cl">     <span class="k">defer</span> <span class="nx">file</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="c1">// 优先自动识别图片格式</span>
</span></span><span class="line"><span class="cl">     <span class="nx">img</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span class="nf">Decode</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">return</span> <span class="nx">img</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">     <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="c1">// fallback: 用后缀判断</span>
</span></span><span class="line"><span class="cl">     <span class="nx">ext</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">ToLower</span><span class="p">(</span><span class="nx">filepath</span><span class="p">.</span><span class="nf">Ext</span><span class="p">(</span><span class="nx">filePath</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">     <span class="nx">_</span><span class="p">,</span> <span class="nx">_</span> <span class="p">=</span> <span class="nx">file</span><span class="p">.</span><span class="nf">Seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">// 重置文件指针</span>
</span></span><span class="line"><span class="cl">     <span class="k">switch</span> <span class="nx">ext</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="k">case</span> <span class="s">&#34;.jpg&#34;</span><span class="p">,</span> <span class="s">&#34;.jpeg&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">          <span class="nx">img</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">jpeg</span><span class="p">.</span><span class="nf">Decode</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="k">case</span> <span class="s">&#34;.png&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">          <span class="nx">img</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span class="nf">Decode</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="k">default</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">          <span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;不支持的图片格式: %s&#34;</span><span class="p">,</span> <span class="nx">ext</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">}</span>
</span></span><span class="line"><span class="cl">     <span class="k">return</span> <span class="nx">img</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 保存图片</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">saveImage</span><span class="p">(</span><span class="nx">img</span> <span class="nx">image</span><span class="p">.</span><span class="nx">Image</span><span class="p">,</span> <span class="nx">outputPath</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="nx">outputPath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">defer</span> <span class="nx">file</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">ext</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">ToLower</span><span class="p">(</span><span class="nx">filepath</span><span class="p">.</span><span class="nf">Ext</span><span class="p">(</span><span class="nx">outputPath</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">switch</span> <span class="nx">ext</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="s">&#34;.jpg&#34;</span><span class="p">,</span> <span class="s">&#34;.jpeg&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nx">err</span> <span class="p">=</span> <span class="nx">jpeg</span><span class="p">.</span><span class="nf">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">jpeg</span><span class="p">.</span><span class="nx">Options</span><span class="p">{</span><span class="nx">Quality</span><span class="p">:</span> <span class="mi">90</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="s">&#34;.png&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span class="nf">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">default</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;不支持的输出格式: %s&#34;</span><span class="p">,</span> <span class="nx">ext</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 调整水印图片大小</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">resizeWatermark</span><span class="p">(</span><span class="nx">watermark</span> <span class="nx">image</span><span class="p">.</span><span class="nx">Image</span><span class="p">,</span> <span class="nx">scale</span> <span class="kt">float64</span><span class="p">)</span> <span class="nx">image</span><span class="p">.</span><span class="nx">Image</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">bounds</span> <span class="o">:=</span> <span class="nx">watermark</span><span class="p">.</span><span class="nf">Bounds</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nx">width</span> <span class="o">:=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float64</span><span class="p">(</span><span class="nx">bounds</span><span class="p">.</span><span class="nf">Dx</span><span class="p">())</span> <span class="o">*</span> <span class="nx">scale</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">height</span> <span class="o">:=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float64</span><span class="p">(</span><span class="nx">bounds</span><span class="p">.</span><span class="nf">Dy</span><span class="p">())</span> <span class="o">*</span> <span class="nx">scale</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 确保宽高至少为1像素</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">width</span> <span class="p">&lt;</span> <span class="mi">1</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">width</span> <span class="p">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">height</span> <span class="p">&lt;</span> <span class="mi">1</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">height</span> <span class="p">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">resized</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span class="nf">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span class="nf">Rect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 简单的缩放算法</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">y</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="nx">x</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">srcX</span> <span class="o">:=</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">bounds</span><span class="p">.</span><span class="nf">Dx</span><span class="p">()</span> <span class="o">/</span> <span class="nx">width</span>
</span></span><span class="line"><span class="cl">            <span class="nx">srcY</span> <span class="o">:=</span> <span class="nx">y</span> <span class="o">*</span> <span class="nx">bounds</span><span class="p">.</span><span class="nf">Dy</span><span class="p">()</span> <span class="o">/</span> <span class="nx">height</span>
</span></span><span class="line"><span class="cl">            <span class="nx">resized</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">watermark</span><span class="p">.</span><span class="nf">At</span><span class="p">(</span><span class="nx">srcX</span><span class="p">,</span> <span class="nx">srcY</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">resized</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 添加平铺水印</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">addTiledWatermark</span><span class="p">(</span><span class="nx">src</span> <span class="nx">image</span><span class="p">.</span><span class="nx">Image</span><span class="p">,</span> <span class="nx">watermark</span> <span class="nx">image</span><span class="p">.</span><span class="nx">Image</span><span class="p">,</span> <span class="nx">density</span> <span class="kt">int</span><span class="p">)</span> <span class="nx">image</span><span class="p">.</span><span class="nx">Image</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">srcBounds</span> <span class="o">:=</span> <span class="nx">src</span><span class="p">.</span><span class="nf">Bounds</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nx">watermarkBounds</span> <span class="o">:=</span> <span class="nx">watermark</span><span class="p">.</span><span class="nf">Bounds</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 创建输出图像</span>
</span></span><span class="line"><span class="cl">    <span class="nx">result</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span class="nf">NewRGBA</span><span class="p">(</span><span class="nx">srcBounds</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">draw</span><span class="p">.</span><span class="nf">Draw</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">srcBounds</span><span class="p">,</span> <span class="nx">src</span><span class="p">,</span> <span class="nx">image</span><span class="p">.</span><span class="nx">Point</span><span class="p">{},</span> <span class="nx">draw</span><span class="p">.</span><span class="nx">Src</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 计算水印平铺的行列数</span>
</span></span><span class="line"><span class="cl">    <span class="nx">cols</span> <span class="o">:=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">math</span><span class="p">.</span><span class="nf">Ceil</span><span class="p">(</span><span class="nb">float64</span><span class="p">(</span><span class="nx">srcBounds</span><span class="p">.</span><span class="nf">Dx</span><span class="p">())</span> <span class="o">/</span> <span class="nb">float64</span><span class="p">(</span><span class="nx">watermarkBounds</span><span class="p">.</span><span class="nf">Dx</span><span class="p">()</span><span class="o">+</span><span class="nx">density</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="nx">rows</span> <span class="o">:=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">math</span><span class="p">.</span><span class="nf">Ceil</span><span class="p">(</span><span class="nb">float64</span><span class="p">(</span><span class="nx">srcBounds</span><span class="p">.</span><span class="nf">Dy</span><span class="p">())</span> <span class="o">/</span> <span class="nb">float64</span><span class="p">(</span><span class="nx">watermarkBounds</span><span class="p">.</span><span class="nf">Dy</span><span class="p">()</span><span class="o">+</span><span class="nx">density</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 平铺水印</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">row</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">row</span> <span class="p">&lt;</span> <span class="nx">rows</span><span class="p">;</span> <span class="nx">row</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="nx">col</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">col</span> <span class="p">&lt;</span> <span class="nx">cols</span><span class="p">;</span> <span class="nx">col</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">x</span> <span class="o">:=</span> <span class="nx">col</span> <span class="o">*</span> <span class="p">(</span><span class="nx">watermarkBounds</span><span class="p">.</span><span class="nf">Dx</span><span class="p">()</span> <span class="o">+</span> <span class="nx">density</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nx">y</span> <span class="o">:=</span> <span class="nx">row</span> <span class="o">*</span> <span class="p">(</span><span class="nx">watermarkBounds</span><span class="p">.</span><span class="nf">Dy</span><span class="p">()</span> <span class="o">+</span> <span class="nx">density</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// 水印位置</span>
</span></span><span class="line"><span class="cl">            <span class="nx">watermarkPos</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span class="nf">Rect</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="nx">x</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nx">y</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nx">x</span><span class="o">+</span><span class="nx">watermarkBounds</span><span class="p">.</span><span class="nf">Dx</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">                <span class="nx">y</span><span class="o">+</span><span class="nx">watermarkBounds</span><span class="p">.</span><span class="nf">Dy</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// 确保水印不超出原图范围</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="nx">watermarkPos</span><span class="p">.</span><span class="nx">Max</span><span class="p">.</span><span class="nx">X</span> <span class="p">&gt;</span> <span class="nx">srcBounds</span><span class="p">.</span><span class="nx">Max</span><span class="p">.</span><span class="nx">X</span> <span class="o">||</span> <span class="nx">watermarkPos</span><span class="p">.</span><span class="nx">Max</span><span class="p">.</span><span class="nx">Y</span> <span class="p">&gt;</span> <span class="nx">srcBounds</span><span class="p">.</span><span class="nx">Max</span><span class="p">.</span><span class="nx">Y</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">watermarkPos</span> <span class="p">=</span> <span class="nx">watermarkPos</span><span class="p">.</span><span class="nf">Intersect</span><span class="p">(</span><span class="nx">srcBounds</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// 绘制水印</span>
</span></span><span class="line"><span class="cl">            <span class="nx">draw</span><span class="p">.</span><span class="nf">Draw</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">watermarkPos</span><span class="p">,</span> <span class="nx">watermark</span><span class="p">,</span> <span class="nx">image</span><span class="p">.</span><span class="nx">Point</span><span class="p">{},</span> <span class="nx">draw</span><span class="p">.</span><span class="nx">Over</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">result</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 解析命令行参数</span>
</span></span><span class="line"><span class="cl">    <span class="nx">config</span> <span class="o">:=</span> <span class="nx">Config</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">SourcePath</span><span class="p">:</span>       <span class="s">&#34;/Users/xxx/Downloads/yuantu.jpg&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">WatermarkPath</span><span class="p">:</span>    <span class="s">&#34;/Users/xxx/Downloads/shuiyin.png&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">OutputPath</span><span class="p">:</span>       <span class="s">&#34;/Users/xxx/Downloads/output.png&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">WatermarkScale</span><span class="p">:</span>   <span class="mf">0.8</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">WatermarkDensity</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// flag.StringVar(&amp;config.SourcePath, &#34;src&#34;, &#34;&#34;, &#34;原图路径 (必填)&#34;)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// flag.StringVar(&amp;config.WatermarkPath, &#34;watermark&#34;, &#34;&#34;, &#34;水印图路径 (必填)&#34;)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// flag.StringVar(&amp;config.OutputPath, &#34;output&#34;, &#34;output.jpg&#34;, &#34;输出图片路径&#34;)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// flag.Float64Var(&amp;config.WatermarkScale, &#34;scale&#34;, 0.3, &#34;水印缩放比例 (0.1-1.0)&#34;)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// flag.IntVar(&amp;config.WatermarkDensity, &#34;density&#34;, 50, &#34;水印密集程度 (间隔像素)&#34;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">flag</span><span class="p">.</span><span class="nf">Parse</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 验证必填参数</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">SourcePath</span> <span class="o">==</span> <span class="s">&#34;&#34;</span> <span class="o">||</span> <span class="nx">config</span><span class="p">.</span><span class="nx">WatermarkPath</span> <span class="o">==</span> <span class="s">&#34;&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;使用方法:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;  watermark -src &lt;原图路径&gt; -watermark &lt;水印图路径&gt; [选项]&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;\n选项:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">flag</span><span class="p">.</span><span class="nf">PrintDefaults</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="nx">os</span><span class="p">.</span><span class="nf">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 验证缩放比例范围</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">WatermarkScale</span> <span class="p">&lt;</span> <span class="mf">0.1</span> <span class="o">||</span> <span class="nx">config</span><span class="p">.</span><span class="nx">WatermarkScale</span> <span class="p">&gt;</span> <span class="mf">1.0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="s">&#34;水印缩放比例必须在 0.1 到 1.0 之间&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 验证密集程度范围</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">WatermarkDensity</span> <span class="p">&lt;</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="s">&#34;水印密集程度必须大于等于 0&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 加载原图</span>
</span></span><span class="line"><span class="cl">    <span class="nx">srcImg</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nf">loadImage</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">SourcePath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;加载原图失败: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 加载水印图</span>
</span></span><span class="line"><span class="cl">    <span class="nx">watermarkImg</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nf">loadImage</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">WatermarkPath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;加载水印图失败: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 调整水印大小</span>
</span></span><span class="line"><span class="cl">    <span class="nx">resizedWatermark</span> <span class="o">:=</span> <span class="nf">resizeWatermark</span><span class="p">(</span><span class="nx">watermarkImg</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">WatermarkScale</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 添加平铺水印</span>
</span></span><span class="line"><span class="cl">    <span class="nx">resultImg</span> <span class="o">:=</span> <span class="nf">addTiledWatermark</span><span class="p">(</span><span class="nx">srcImg</span><span class="p">,</span> <span class="nx">resizedWatermark</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">WatermarkDensity</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 保存结果</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nf">saveImage</span><span class="p">(</span><span class="nx">resultImg</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">OutputPath</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;保存图片失败: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;水印添加成功，已保存到: %s\n&#34;</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">OutputPath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content"></span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2025-05-21
        
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/%E6%B0%B4%E5%8D%B0/">水印</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/ai/ai%E6%8F%90%E7%A4%BA%E8%AF%8D%E6%8B%9F%E4%BA%BA%E5%8C%96/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">AI提示词拟人化</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/python/%E8%A7%86%E9%A2%91%E5%88%87%E5%89%B2/">
            <span class="next-text nav-default">视频切割</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js" crossorigin="anonymous"></script>
    <script type="text/javascript">
      var gitalk = new Gitalk({
        id: '2025-05-21 10:35:55 \u002b0800 CST',
        title: '图片水印',
        clientID: 'fe63c88fe7fc18e38512',
        clientSecret: 'e44ced40487d261a6006f9af23a2f788bf1e0a85',
        repo: 'zsmhub.github.io',
        owner: 'zsmhub',
        admin: ['zsmhub'],
        body: decodeURI(location.href)
      });
      gitalk.render('gitalk-container');
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/gitalk/gitalk">comments powered by gitalk.</a></noscript>

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:zhangshimiande@email.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/zsmhub" class="iconfont icon-github" title="github"></a>
  
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2019 - 
    2025<span class="heart"><i class="iconfont icon-heart"></i></span><span>ZsmHub</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
